<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>qepi. - Packing Planner</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='20' fill='%23A8D05F'/%3E%3Ctext x='50' y='72' font-family='Arial, sans-serif' font-size='65' font-weight='700' fill='white' text-anchor='middle'%3Eq%3C/text%3E%3C/svg%3E">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Fluid Typography Scale - Sleeker & Smaller */
            --text-xs: clamp(0.625rem, 0.6rem + 0.15vw, 0.6875rem);   /* 10-11px */
            --text-sm: clamp(0.75rem, 0.72rem + 0.2vw, 0.8125rem);    /* 12-13px */
            --text-base: clamp(0.8125rem, 0.78rem + 0.2vw, 0.875rem); /* 13-14px */
            --text-lg: clamp(0.9375rem, 0.9rem + 0.25vw, 1.0625rem);  /* 15-17px */
            --text-xl: clamp(1.125rem, 1.05rem + 0.35vw, 1.375rem);   /* 18-22px */
            --text-2xl: clamp(1.5rem, 1.35rem + 0.75vw, 2rem);        /* 24-32px */
            --text-3xl: clamp(2rem, 1.75rem + 1.25vw, 2.75rem);       /* 32-44px */
            
            /* Accent Colors - Fresh Lime Green */
            --accent-primary: #A8D05F;
            --accent-hover: #96BE4F;
            --accent-light: #F0F7E6;
            --accent-shadow: rgba(168, 208, 95, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
            padding: 0;
            display: flex;
            font-size: var(--text-base);
        }

        .app-layout {
            display: flex;
            width: 100%;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: white;
            padding: 30px 20px;
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar-logo {
            padding: 0 0 20px 0;
            margin-bottom: 20px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: opacity 0.3s;
        }

        .sidebar-logo:hover {
            opacity: 0.8;
        }

        .sidebar-logo svg {
            display: block;
        }

        .sidebar-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #f0f0f0;
        }

        .sidebar-profile-pic {
            width: clamp(40px, 10vw, 48px);
            height: clamp(40px, 10vw, 48px);
            border-radius: 12px;
            overflow: hidden;
            background: var(--accent-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: var(--text-lg);
        }

        .sidebar-profile-info h3 {
            font-size: var(--text-base);
            color: #1a1a1a;
            margin-bottom: 2px;
        }

        .sidebar-profile-info p {
            font-size: var(--text-xs);
            color: #999;
        }

        .new-trip-btn {
            width: 100%;
            padding: clamp(10px, 3vw, 12px);
            background: var(--accent-primary);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: var(--text-sm);
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 25px;
            transition: all 0.3s;
            box-shadow: 0 3px 12px var(--accent-shadow);
        }

        .new-trip-btn:hover {
            background: var(--accent-hover);
            transform: translateY(-1px);
            box-shadow: 0 4px 16px var(--accent-shadow);
        }

        .sidebar-section {
            margin-bottom: 25px;
        }

        .sidebar-section-title {
            font-size: var(--text-xs);
            color: #999;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .sidebar-trips-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .sidebar-trip-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .sidebar-trip-item:hover {
            background: #f8f9fa;
        }

        .sidebar-trip-item.active {
            background: var(--accent-light);
            border-left: 3px solid var(--accent-primary);
        }

        .trip-flag {
            font-size: var(--text-lg);
        }

        .trip-info h4 {
            font-size: var(--text-sm);
            color: #1a1a1a;
            margin-bottom: 2px;
        }

        .trip-info p {
            font-size: var(--text-xs);
            color: #999;
        }

        .sidebar-nav {
            display: flex;
            flex-direction: column;
            gap: 4px;
            flex: 1;
        }

        .sidebar-nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 14px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            color: #666;
            font-size: var(--text-sm);
            font-weight: 500;
        }

        .sidebar-nav-item:hover {
            background: #f8f9fa;
            color: #1a1a1a;
        }

        .sidebar-nav-item.active {
            background: var(--accent-light);
            color: var(--accent-primary);
        }

        .sidebar-nav-item .icon {
            width: 20px;
            text-align: center;
            font-size: 18px;
        }

        .badge-new {
            background: #667eea;
            color: white;
            font-size: 9px;
            padding: 3px 8px;
            border-radius: 10px;
            font-weight: 700;
            text-transform: uppercase;
            margin-left: auto;
        }

        .sidebar-language {
            margin-top: auto;
            padding-top: 15px;
        }

        .lang-btn {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 14px;
            background: transparent;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            color: #666;
            font-size: 14px;
            font-weight: 500;
            width: 100%;
            transition: all 0.2s;
        }

        .lang-btn:hover {
            background: #f8f9fa;
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }

        .lang-btn .icon {
            font-size: 16px;
        }

        .sidebar-logout {
            padding-top: 15px;
            border-top: 1px solid #f0f0f0;
            margin-top: 15px;
        }

        .logout-btn {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 14px;
            background: transparent;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            color: #ff5252;
            font-size: 14px;
            font-weight: 500;
            width: 100%;
            transition: all 0.2s;
        }

        .logout-btn:hover {
            background: #fff0f0;
        }

        /* Main Content */
        .main-content {
            margin-left: 260px;
            flex: 1;
            padding: 40px 50px;
            overflow-y: auto;
        }

        .container {
            max-width: 1200px;
        }

        /* Page Header */
        .page-header {
            margin-bottom: 32px;
        }

        .greeting {
            font-size: var(--text-2xl);
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 6px;
            letter-spacing: -0.5px;
        }

        .greeting-wave {
            display: inline-block;
            animation: wave 0.5s ease-in-out;
        }

        @keyframes wave {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(20deg); }
            75% { transform: rotate(-20deg); }
        }

        .subheading {
            font-size: var(--text-base);
            color: #999;
        }

        /* API Setup Banner */
        .api-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
        }

        .api-banner-icon {
            font-size: 24px;
            flex-shrink: 0;
        }

        .api-banner-content {
            flex: 1;
        }

        .api-banner-content h4 {
            margin: 0 0 6px 0;
            font-size: var(--text-base);
            font-weight: 600;
        }

        .api-banner-content p {
            margin: 0;
            font-size: var(--text-sm);
            opacity: 0.95;
            line-height: 1.5;
        }

        .api-banner-link {
            color: white;
            text-decoration: underline;
            font-weight: 600;
        }

        .api-banner-link:hover {
            opacity: 0.8;
        }

        .api-banner-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            line-height: 1;
            flex-shrink: 0;
            transition: all 0.3s;
        }

        .api-banner-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .top-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
        }

        .icon-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
        }

        .icon-btn:hover {
            background: #f8f9fa;
            border-color: var(--accent-primary);
            transform: scale(1.05);
        }

        .lang-selector {
            padding: 8px 16px;
            border: 1px solid #e0e0e0;
            border-radius: 20px;
            background: white;
            color: #666;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .lang-selector:hover {
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }

        .user-info {
            display: none;
        }

        /* Auth Screen */
        .auth-screen {
            max-width: 520px;
            margin: 60px auto;
            background: white;
            padding: 60px 55px;
            border-radius: 24px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 10;
        }

        .auth-logo {
            text-align: center;
            margin-bottom: 35px;
            cursor: pointer;
            transition: opacity 0.3s;
        }

        .auth-logo:hover {
            opacity: 0.8;
        }

        .auth-logo svg {
            filter: drop-shadow(0 4px 20px rgba(168, 208, 95, 0.25));
        }

        .auth-screen h2 {
            color: #1a1a1a;
            margin-bottom: 35px;
            text-align: center;
            font-size: 36px;
            font-weight: 700;
        }

        .form-group {
            margin-bottom: 22px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            color: #666;
            font-weight: 500;
            font-size: 14px;
        }

        .form-group input {
            width: 100%;
            padding: 14px 16px;
            border: 1.5px solid #e0e0e0;
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.3s;
            background: white;
            color: #1a1a1a;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px var(--accent-light);
        }

        .form-group input::placeholder {
            color: #bbb;
        }

        /* Autocomplete Suggestions */
        .autocomplete-container {
            position: relative;
        }

        .autocomplete-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #e0e0e0;
            border-top: none;
            border-radius: 0 0 12px 12px;
            max-height: 250px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .autocomplete-suggestions.active {
            display: block;
        }

        .autocomplete-item {
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 1px solid #f5f5f5;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .autocomplete-item:last-child {
            border-bottom: none;
        }

        .autocomplete-item:hover {
            background: #f8f9fa;
        }

        .autocomplete-item-icon {
            font-size: 16px;
            opacity: 0.6;
        }

        .autocomplete-item-text {
            flex: 1;
        }

        .autocomplete-item-name {
            color: #1a1a1a;
            font-weight: 500;
            font-size: 14px;
        }

        .autocomplete-item-region {
            color: #999;
            font-size: 12px;
            margin-top: 2px;
        }

        .autocomplete-loading {
            padding: 12px 16px;
            text-align: center;
            color: #999;
            font-size: 13px;
        }

        .autocomplete-no-results {
            padding: 12px 16px;
            text-align: center;
            color: #999;
            font-size: 13px;
        }

        .btn {
            width: 100%;
            padding: 15px 20px;
            background: var(--accent-primary);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 2px 8px var(--accent-shadow);
        }

        .btn:hover {
            background: var(--accent-hover);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px var(--accent-shadow);
        }

        .btn-secondary {
            background: white;
            color: var(--accent-primary);
            border: 2px solid var(--accent-primary);
            margin-top: 12px;
            box-shadow: none;
        }

        .btn-secondary:hover {
            background: var(--accent-light);
        }

        /* Landing Page Heading - Removed, using page-header instead */

        /* Trip Form */
        .trip-form {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.08);
            margin-bottom: 40px;
        }

        .trip-form h2 {
            color: #1a1a1a;
            margin-bottom: 25px;
            font-size: 20px;
            font-weight: 700;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        /* Date Range Picker Button */
        .date-picker-button {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            text-align: left;
            font-size: 14px;
            color: #bbb;
            transition: all 0.3s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .date-picker-button:hover {
            border-color: var(--accent-primary);
        }

        .date-picker-button.has-dates {
            color: #1a1a1a;
            font-weight: 500;
        }

        /* Date Range Picker Modal */
        .date-range-picker {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            max-width: 400px;
            width: 90%;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .calendar-header button {
            background: var(--accent-primary);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
        }

        .calendar-header button:hover {
            background: var(--accent-hover);
        }

        .calendar-header h4 {
            color: #1a1a1a;
            font-size: 16px;
            margin: 0;
            font-weight: 700;
        }

        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin-bottom: 8px;
        }

        .calendar-weekday {
            text-align: center;
            font-size: 11px;
            font-weight: 600;
            color: #999;
            padding: 4px;
        }

        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin-bottom: 15px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
            border: 2px solid transparent;
            color: #1a1a1a;
        }

        .calendar-day:hover {
            background: var(--accent-light);
        }

        .calendar-day.other-month {
            color: #ccc;
        }

        .calendar-day.selected-start,
        .calendar-day.selected-end {
            background: var(--accent-primary);
            color: white;
            font-weight: bold;
        }

        .calendar-day.in-range {
            background: var(--accent-light);
            color: var(--accent-primary);
        }

        .calendar-day.today {
            border: 2px solid var(--accent-primary);
        }

        .selected-dates-display {
            margin-top: 10px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 12px;
            text-align: center;
        }

        .selected-dates-display p {
            margin: 5px 0;
            color: #1a1a1a;
            font-weight: 600;
            font-size: var(--text-sm);
        }

        .selected-dates-display .date-range {
            font-size: var(--text-sm);
            color: #666;
        }

        .calendar-close-btn {
            width: 100%;
            margin-top: 15px;
        }

        /* Activity Date Picker Modal */
        .activity-date-picker {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            max-width: 380px;
            width: 90%;
        }

        .activity-date-picker .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .activity-date-picker .calendar-header h4 {
            color: #1a1a1a;
            font-size: var(--text-lg);
            margin: 0;
            font-weight: 700;
        }

        .activity-date-picker .calendar-close-icon {
            background: none;
            border: none;
            font-size: 28px;
            color: #999;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s;
        }

        .activity-date-picker .calendar-close-icon:hover {
            background: #f0f0f0;
            color: #666;
        }

        .activity-date-picker .calendar-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .activity-date-picker .calendar-nav button {
            background: var(--accent-primary);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.2s;
        }

        .activity-date-picker .calendar-nav button:hover {
            background: var(--accent-hover);
            transform: scale(1.05);
        }

        .activity-date-picker .calendar-nav span {
            font-size: var(--text-base);
            font-weight: 700;
            color: #1a1a1a;
        }

        .activity-date-picker .calendar-day.selected {
            background: var(--accent-primary);
            color: white;
            font-weight: bold;
        }

        /* Trips Grid */
        .trips-section {
            margin-bottom: 40px;
        }

        .trips-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .trips-section h2 {
            color: var(--accent-primary);
            font-size: var(--text-lg);
            font-weight: 600;
            letter-spacing: -0.3px;
            text-transform: capitalize;
        }

        .view-details-link {
            color: var(--accent-primary);
            font-size: var(--text-sm);
            font-weight: 500;
            cursor: pointer;
            text-decoration: none;
        }

        .view-details-link:hover {
            text-decoration: underline;
        }

        .trips-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 20px;
        }

        .trip-card {
            background: white;
            padding: 32px 28px;
            border-radius: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            border: 1px solid #f0f0f0;
            min-height: 180px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .trip-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            border-color: #e0e0e0;
        }

        .trip-card-header {
            display: flex;
            gap: 16px;
            align-items: flex-start;
            position: relative;
        }

        .trip-card-icon {
            width: 48px;
            height: 48px;
            min-width: 48px;
            background: #f5f5f5;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 400;
            color: #666;
            line-height: 1;
        }

        .trip-card-main {
            flex: 1;
        }

        .trip-card h3 {
            color: #1a1a1a;
            margin: 0 0 6px 0;
            font-size: var(--text-base);
            font-weight: 600;
            letter-spacing: -0.3px;
        }

        .trip-card-subtitle {
            color: #999;
            font-size: var(--text-xs);
            margin: 0 0 10px 0;
        }

        .trip-card-dates {
            color: #888;
            font-size: var(--text-xs);
            margin: 0 0 14px 0;
            line-height: 1.5;
        }

        .trip-card-socket {
            color: #666;
            font-size: var(--text-xs);
            margin: 0;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .trip-card-socket svg {
            flex-shrink: 0;
        }

        .trip-duration-badge-card {
            padding: 6px 14px;
            background: var(--accent-primary);
            color: white;
            border-radius: 16px;
            font-size: var(--text-xs);
            font-weight: 600;
            white-space: nowrap;
            letter-spacing: 0.3px;
        }

        /* Past Trips */
        .past-trips-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 20px;
        }

        /* Trip Detail Page */
        .trip-detail {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: white;
            color: #666;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .back-btn:hover {
            border-color: var(--accent-primary);
            color: var(--accent-primary);
            transform: translateX(-3px);
        }

        /* Trip Header Compact */
        .trip-header-compact {
            margin-bottom: 35px;
            padding-bottom: 30px;
            border-bottom: 1px solid #f0f0f0;
        }

        .trip-header-top {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .trip-icon {
            width: clamp(50px, 12vw, 60px);
            height: clamp(50px, 12vw, 60px);
            border-radius: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: var(--text-xl);
            font-weight: 700;
            flex-shrink: 0;
            transition: all 0.3s ease;
            position: relative;
        }

        .trip-icon:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .trip-icon:active {
            transform: scale(0.98);
        }

        .trip-name-inline {
            font-size: var(--text-xl);
            color: #1a1a1a;
            border: none;
            background: transparent;
            padding: 0;
            font-weight: 700;
            flex: 1;
            min-width: 200px;
        }

        .trip-name-inline:focus {
            outline: none;
            border-bottom: 2px solid var(--accent-primary);
        }

        .trip-duration-badge {
            padding: 6px 16px;
            background: var(--accent-primary);
            color: white;
            border-radius: 16px;
            font-size: var(--text-xs);
            font-weight: 600;
            white-space: nowrap;
            letter-spacing: 0.3px;
        }

        .trip-socket-inline {
            padding: clamp(6px, 2vw, 8px) clamp(14px, 4vw, 18px);
            background: #f8f9fa;
            color: #666;
            border-radius: 20px;
            font-size: var(--text-sm);
            font-weight: 500;
            white-space: nowrap;
            border: 1px solid #e0e0e0;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .trip-socket-inline svg {
            flex-shrink: 0;
        }

        .delete-trip-btn {
            padding: 8px 18px;
            background: white;
            color: #666;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
            margin-left: auto;
        }

        .delete-trip-btn:hover {
            border-color: #ff5252;
            color: #ff5252;
            background: #fff5f5;
        }

        .trip-subtitle-inline {
            color: #999;
            font-size: var(--text-base);
            margin-left: clamp(0px, 10vw, 80px);
        }

        /* Notes Section */
        .notes-section {
            margin-bottom: 35px;
        }

        .notes-section h3 {
            color: #1a1a1a;
            font-size: var(--text-lg);
            font-weight: 700;
            margin-bottom: 15px;
        }

        .trip-notes {
            width: 100%;
            min-height: 120px;
            padding: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: var(--text-sm);
            font-family: inherit;
            color: #1a1a1a;
            background: #f8f9fa;
            resize: vertical;
            transition: all 0.3s;
        }

        .trip-notes:focus {
            outline: none;
            border-color: var(--accent-primary);
            background: white;
        }

        .trip-notes::placeholder {
            color: #bbb;
        }

        /* Activities */
        .activities-section {
            margin-bottom: 35px;
        }

        .activities-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .activities-section h3 {
            color: #1a1a1a;
            font-size: var(--text-lg);
            font-weight: 700;
            margin: 0;
        }

        .add-activity-link {
            background: transparent;
            color: var(--accent-primary);
            border: none;
            font-size: var(--text-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
        }

        .add-activity-link:hover {
            color: var(--accent-hover);
            text-decoration: underline;
        }

        .activities-list {
            display: grid;
            gap: 12px;
        }

        .no-activities {
            color: #999;
            font-size: var(--text-sm);
            padding: 20px;
            text-align: center;
            background: #f8f9fa;
            border-radius: 12px;
            border: 1px dashed #e0e0e0;
        }

        .activity-item {
            display: grid;
            grid-template-columns: 50px 150px 1fr 190px 110px;
            gap: 12px;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 1px solid #f0f0f0;
        }

        .activity-emoji {
            font-size: 24px;
            cursor: pointer;
            text-align: center;
            transition: transform 0.2s;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            border-radius: 12px;
            border: 2px solid #e0e0e0;
        }

        .activity-emoji:hover {
            transform: scale(1.1);
            border-color: var(--accent-primary);
        }

        .activity-item input[type="text"] {
            padding: 10px 14px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: var(--text-sm);
            background: white;
            color: #1a1a1a;
            transition: all 0.3s;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .activity-item input[type="text"]:hover {
            border-color: #ccc;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
        }

        .activity-item input[readonly] {
            background: white;
            cursor: pointer !important;
        }

        .activity-item input[readonly]:hover {
            border-color: var(--accent-primary);
            box-shadow: 0 2px 8px rgba(168, 208, 95, 0.2);
        }

        .activity-item input[readonly]:focus {
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(168, 208, 95, 0.1);
        }

        .activity-item input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        /* Toggle Switch for Day/Night */
        .activity-type-toggle {
            display: inline-flex;
            align-items: center;
            background: white;
            border-radius: 20px;
            padding: 4px;
            border: 1px solid #e0e0e0;
            position: relative;
            height: 38px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            transition: all 0.3s;
            gap: 4px;
            width: fit-content;
            min-width: 180px;
        }

        .activity-type-toggle:hover {
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
        }

        .activity-type-option {
            flex: 1;
            padding: 7px 16px;
            border-radius: 16px;
            font-size: var(--text-xs);
            font-weight: 600;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            color: #999;
            z-index: 1;
            white-space: nowrap;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            min-width: 80px;
        }

        .activity-type-option.active {
            color: white;
            background: var(--accent-primary);
            box-shadow: 0 2px 4px rgba(168, 208, 95, 0.3);
        }

        .activity-type-option:not(.active):hover {
            color: #666;
            background: #f5f5f5;
        }

        /* Activity Saved/View State */
        .activity-item.saved {
            background: white;
            border: 1px solid #e8e8e8;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 20px;
        }

        .activity-saved-content {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .activity-saved-emoji {
            font-size: 24px;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--accent-light);
            border-radius: 12px;
        }

        .activity-saved-details {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .activity-saved-name {
            font-size: var(--text-base);
            font-weight: 600;
            color: #1a1a1a;
        }

        .activity-saved-meta {
            display: flex;
            gap: 12px;
            align-items: center;
            font-size: var(--text-xs);
            color: #666;
        }

        .activity-saved-date {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .activity-saved-type {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 3px 10px;
            background: var(--accent-light);
            color: var(--accent-primary);
            border-radius: 12px;
            font-weight: 600;
        }

        .activity-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .edit-btn {
            background: white;
            color: var(--accent-primary);
            border: 1px solid var(--accent-primary);
            border-radius: 8px;
            padding: 8px 16px;
            cursor: pointer;
            font-size: var(--text-xs);
            font-weight: 600;
            transition: all 0.2s;
        }

        .edit-btn:hover {
            background: var(--accent-primary);
            color: white;
        }

        .save-btn {
            background: var(--accent-primary);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            cursor: pointer;
            font-size: var(--text-xs);
            font-weight: 600;
            transition: all 0.2s;
        }

        .save-btn:hover {
            background: var(--accent-hover);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(168, 208, 95, 0.3);
        }

        .save-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .delete-btn {
            background: white;
            color: #ff5252;
            border: 1px solid #ff5252;
            border-radius: 8px;
            padding: 8px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .delete-btn:hover {
            background: #ff5252;
            color: white;
        }

        /* Clothing Drop Animation */
        .clothing-animation-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
            overflow: hidden;
        }

        .clothing-item {
            position: absolute;
            font-size: 40px;
            animation: dropAndFade 2s ease-in forwards;
            opacity: 0;
        }

        /* Background Clothing Animation for Auth Screen */
        .auth-bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }

        .auth-bg-clothing {
            position: absolute;
            font-size: 35px;
            animation: bgDropAndFade 8s linear infinite;
            opacity: 0;
        }

        @keyframes dropAndFade {
            0% {
                transform: translateY(-50px) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            70% {
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        @keyframes bgDropAndFade {
            0% {
                transform: translateY(-80px) rotate(0deg);
                opacity: 0;
            }
            5% {
                opacity: 0.15;
            }
            85% {
                opacity: 0.15;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        @keyframes wiggle {
            0%, 100% {
                transform: rotate(-3deg);
            }
            50% {
                transform: rotate(3deg);
            }
        }

        .packing-animation {
            animation: wiggle 0.3s ease-in-out 3;
        }

        .add-btn {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 10px 20px;
            background: white;
            color: var(--accent-primary);
            border: 2px solid var(--accent-primary);
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin-top: 10px;
            transition: all 0.3s;
        }

        .add-btn:hover {
            background: var(--accent-primary);
            color: white;
        }

        /* Checklists */
        .checklists-header-section {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 15px;
        }

        .add-list-btn {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 10px 20px;
            background: white;
            border: 2px solid #8bc34a;
            border-radius: 12px;
            color: #8bc34a;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .add-list-btn:hover {
            background: #8bc34a;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 195, 74, 0.3);
        }

        .checklists-section {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
            transition: grid-template-columns 0.3s ease;
        }

        .checklists-section:not(:has(#customListColumn[style*="display: none"])) {
            grid-template-columns: repeat(3, 1fr);
        }

        .checklists-section:has(#customListColumn[style*="display: none"]) {
            grid-template-columns: repeat(2, 1fr);
        }

        .checklist-column {
            background: white;
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.08);
            border: 1px solid #f0f0f0;
        }

        .checklist-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .checklist-column h3 {
            color: #1a1a1a;
            font-size: 17px;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .checklist-column h3 input {
            border: none;
            background: transparent;
            color: #1a1a1a;
            font-size: 17px;
            font-weight: 700;
            width: 100%;
        }

        .checklist-column h3 input:focus {
            outline: 2px solid var(--accent-primary);
            border-radius: 5px;
        }

        .checklist-items {
            display: grid;
            gap: 8px;
        }

        .checklist-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid transparent;
            transition: all 0.3s;
        }

        .checklist-item:hover {
            border-color: #e0e0e0;
        }

        .checklist-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--accent-primary);
        }

        .checklist-item input[type="text"] {
            flex: 1;
            border: none;
            background: transparent;
            font-size: 14px;
            color: #1a1a1a;
        }

        .checklist-item input[type="text"]::placeholder {
            color: #bbb;
        }

        .checklist-item.checked {
            opacity: 0.5;
        }

        .checklist-item.checked input[type="text"] {
            text-decoration: line-through;
            color: #999;
        }

        /* Outfit Planner */
        .outfit-planner {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid #f0f0f0;
        }

        .outfit-planner h3 {
            color: #1a1a1a;
            margin-bottom: 20px;
            font-size: 20px;
            font-weight: 700;
        }

        .week-row {
            margin-bottom: 30px;
        }

        .week-label {
            color: #1a1a1a;
            font-weight: 600;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .days-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }

        .day-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            border: 1px solid #e0e0e0;
            transition: all 0.3s;
            overflow: hidden;
            max-width: 100%;
        }

        .day-card:hover {
            border-color: var(--accent-primary);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.1);
        }

        .day-header {
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .day-date {
            color: #999;
            font-size: 12px;
            margin-bottom: 10px;
        }

        .weather-info {
            background: var(--accent-light);
            padding: 8px;
            border-radius: 8px;
            margin-bottom: 12px;
            font-size: 12px;
            text-align: center;
            color: var(--accent-primary);
            border: 1px solid var(--accent-light);
        }

        .day-activities-section {
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 1px solid #f0f0f0;
        }

        .day-activities-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .day-activities-header h5 {
            font-size: 10px;
            color: #999;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
            margin: 0;
        }

        .add-day-activity-btn {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accent-primary);
            color: white;
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            padding: 0;
            transition: all 0.2s;
        }

        .add-day-activity-btn:hover {
            background: var(--accent-hover);
            transform: scale(1.1);
        }

        .day-activities-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .day-activity-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 8px;
            background: var(--accent-light);
            border-radius: 6px;
            font-size: var(--text-xs);
        }

        .day-activity-icon {
            font-size: 14px;
            flex-shrink: 0;
        }

        .day-activity-name {
            flex: 1;
            color: #1a1a1a;
            font-weight: 500;
        }

        .remove-day-activity-btn {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: transparent;
            color: #999;
            border: none;
            font-size: 18px;
            font-weight: 400;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            padding: 0;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .remove-day-activity-btn:hover {
            background: #fff;
            color: #ff5252;
            transform: scale(1.1);
        }

        .no-day-activities {
            font-size: var(--text-xs);
            color: #bbb;
            font-style: italic;
            text-align: center;
            padding: 10px;
        }

        .activity-links {
            font-size: 11px;
            color: #999;
            margin-bottom: 10px;
        }

        .outfit-section {
            margin-bottom: 18px;
            padding-bottom: 12px;
            width: 100%;
            max-width: 100%;
            overflow: hidden;
        }

        .outfit-section:not(:last-child) {
            border-bottom: 1px solid #f5f5f5;
        }

        .outfit-section h5 {
            font-size: 11px;
            color: #999;
            margin-bottom: 10px;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .outfit-items {
            display: grid;
            gap: 6px;
            width: 100%;
            max-width: 100%;
        }

        .outfit-item {
            display: flex;
            gap: 8px;
            font-size: 11px;
            color: #666;
            align-items: center;
            width: 100%;
            max-width: 100%;
            overflow: hidden;
        }

        .outfit-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
            flex-shrink: 0;
            accent-color: #4a90e2;
        }

        .outfit-item-content {
            display: flex;
            gap: 8px;
            flex: 1;
            min-width: 0;
            align-items: center;
            cursor: pointer;
            transition: opacity 0.3s;
        }

        .outfit-item-content.packed {
            opacity: 0.5;
        }

        .outfit-item-content.packed .outfit-input {
            text-decoration: line-through;
        }

        .outfit-label {
            min-width: 60px;
            flex-shrink: 0;
            white-space: nowrap;
        }

        .outfit-input {
            flex: 1;
            min-width: 0;
            max-width: 100%;
            padding: 6px 8px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 12px;
            background: white;
            color: #1a1a1a;
            transition: all 0.3s;
            box-sizing: border-box;
        }

        .outfit-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }

        .outfit-item input::placeholder {
            color: #bbb;
        }

        .hidden {
            display: none;
        }

        .emoji-picker {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            max-width: 400px;
        }

        .emoji-picker h3 {
            color: #1a1a1a;
            font-weight: 700;
        }

        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .emoji-option {
            font-size: 24px;
            cursor: pointer;
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .emoji-option:hover {
            background: #f0f0f0;
            transform: scale(1.2);
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        /* Activity Modal */
        .activity-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .activity-modal.hidden {
            display: none;
        }

        .activity-modal-content {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 500px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .activity-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 25px;
            border-bottom: 1px solid #f0f0f0;
        }

        .activity-modal-header h3 {
            margin: 0;
            font-size: var(--text-lg);
            color: #1a1a1a;
            font-weight: 700;
        }

        .activity-modal-close {
            background: transparent;
            border: none;
            font-size: 32px;
            color: #999;
            cursor: pointer;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.2s;
            line-height: 1;
            padding: 0;
        }

        .activity-modal-close:hover {
            background: #f8f9fa;
            color: #666;
        }

        .activity-modal-body {
            padding: 25px;
            overflow-y: auto;
            flex: 1;
        }

        .activity-emoji-button {
            width: 80px;
            height: 80px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            background: #f8f9fa;
            font-size: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .activity-emoji-button:hover {
            border-color: var(--accent-primary);
            background: var(--accent-light);
            transform: scale(1.05);
        }

        .activity-date-button {
            width: 100%;
            padding: 11px 14px;
            border: 1.5px solid #e0e0e0;
            border-radius: 10px;
            background: white;
            font-size: var(--text-sm);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            color: #1a1a1a;
        }

        .activity-date-button:hover {
            border-color: var(--accent-primary);
        }

        .activity-date-button:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px var(--accent-light);
        }

        .activity-toggle {
            display: flex;
            gap: 10px;
        }

        .activity-toggle-btn {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
            font-size: var(--text-sm);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
            font-weight: 500;
        }

        .activity-toggle-btn:hover {
            border-color: var(--accent-primary);
            background: var(--accent-light);
        }

        .activity-toggle-btn.active {
            border-color: var(--accent-primary);
            background: var(--accent-primary);
            color: white;
        }

        .activity-toggle-btn span:first-child {
            font-size: 18px;
        }

        .activity-modal-footer {
            padding: 20px 25px;
            border-top: 1px solid #f0f0f0;
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .activity-modal-footer .btn {
            width: auto;
            min-width: 120px;
        }

        /* Emoji Picker Modal */
        .emoji-picker-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1001;
            padding: 20px;
        }

        .emoji-picker-modal.hidden {
            display: none;
        }

        .emoji-picker-content {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 500px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .emoji-picker-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 25px;
            border-bottom: 1px solid #f0f0f0;
        }

        .emoji-picker-header h3 {
            margin: 0;
            font-size: var(--text-lg);
            color: #1a1a1a;
            font-weight: 700;
        }

        .emoji-picker-close {
            background: transparent;
            border: none;
            font-size: 32px;
            color: #999;
            cursor: pointer;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.2s;
            line-height: 1;
            padding: 0;
        }

        .emoji-picker-close:hover {
            background: #f8f9fa;
            color: #666;
        }

        .emoji-picker-search {
            padding: 15px 25px;
            border-bottom: 1px solid #f0f0f0;
        }

        .emoji-picker-search input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: var(--text-sm);
            transition: all 0.3s;
            font-family: inherit;
        }

        .emoji-picker-search input:focus {
            outline: none;
            border-color: var(--accent-primary);
            background: #fff;
        }

        .emoji-picker-categories {
            display: flex;
            gap: 8px;
            padding: 15px 25px;
            border-bottom: 1px solid #f0f0f0;
            overflow-x: auto;
            scrollbar-width: thin;
        }

        .emoji-picker-categories::-webkit-scrollbar {
            height: 6px;
        }

        .emoji-picker-categories::-webkit-scrollbar-track {
            background: #f0f0f0;
            border-radius: 3px;
        }

        .emoji-picker-categories::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 3px;
        }

        .emoji-category-btn {
            padding: 8px 14px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 20px;
            font-size: var(--text-xs);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
            color: #666;
        }

        .emoji-category-btn:hover {
            border-color: var(--accent-primary);
            background: var(--accent-light);
            color: var(--accent-primary);
        }

        .emoji-category-btn.active {
            border-color: var(--accent-primary);
            background: var(--accent-primary);
            color: white;
        }

        .emoji-picker-grid {
            padding: 20px 25px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(45px, 1fr));
            gap: 8px;
            overflow-y: auto;
            flex: 1;
            max-height: 400px;
        }

        .emoji-picker-grid::-webkit-scrollbar {
            width: 8px;
        }

        .emoji-picker-grid::-webkit-scrollbar-track {
            background: #f0f0f0;
            border-radius: 4px;
        }

        .emoji-picker-grid::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 4px;
        }

        .emoji-picker-grid::-webkit-scrollbar-thumb:hover {
            background: #999;
        }

        .emoji-item {
            width: 100%;
            aspect-ratio: 1;
            border: none;
            background: transparent;
            font-size: 28px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }

        .emoji-item:hover {
            background: #f8f9fa;
            transform: scale(1.15);
        }

        .emoji-item:active {
            transform: scale(0.95);
        }

        .emoji-picker-empty {
            grid-column: 1 / -1;
            text-align: center;
            padding: 40px 20px;
            color: #999;
            font-size: var(--text-sm);
        }

        @media (max-width: 768px) {
            .emoji-picker-modal {
                padding: 10px;
            }

            .emoji-picker-content {
                max-width: 100%;
                max-height: 85vh;
                border-radius: 16px;
            }

            .emoji-picker-header {
                padding: 16px 20px;
            }

            .emoji-picker-header h3 {
                font-size: var(--text-base);
            }

            .emoji-picker-search {
                padding: 12px 20px;
            }

            .emoji-picker-categories {
                padding: 12px 20px;
            }

            .emoji-picker-grid {
                padding: 15px 20px;
                grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
                gap: 6px;
            }

            .emoji-item {
                font-size: 24px;
            }
        }

        @media (max-width: 1200px) {
            .trips-grid, .past-trips-grid {
                grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            }
        }

        @media (max-width: 1024px) {
            .sidebar {
                position: fixed;
                left: -260px;
                transition: left 0.3s;
                z-index: 100;
            }

            .sidebar.open {
                left: 0;
            }

            .main-content {
                margin-left: 0;
            }
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .trip-info-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .checklists-section {
                grid-template-columns: 1fr;
            }

            .days-grid {
                grid-template-columns: 1fr;
            }

            .trips-grid {
                grid-template-columns: 1fr;
            }

            .past-trips-grid {
                grid-template-columns: 1fr;
            }

            .trip-card {
                padding: 24px 20px;
                min-height: 160px;
            }

            .trip-card-icon {
                width: 48px;
                height: 48px;
                min-width: 48px;
                font-size: 24px;
            }

            .trip-duration-badge-card {
                font-size: 12px;
                padding: 5px 12px;
            }

            .main-content {
                padding: 20px;
            }

            .greeting {
                font-size: 24px;
            }

            .calendar-day {
                font-size: 12px;
            }

            .trip-header-top {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .trip-name-inline {
                font-size: 24px;
                width: 100%;
            }

            .trip-subtitle-inline {
                margin-left: 0;
            }

            .delete-trip-btn {
                margin-left: 0;
                width: 100%;
                justify-content: center;
            }

            .activity-item {
                grid-template-columns: 1fr;
                gap: 10px;
                padding: 12px;
            }

            .activity-emoji {
                width: 45px;
                height: 45px;
                font-size: 22px;
            }

            .activity-item input[type="text"],
            .activity-item input[readonly],
            .activity-type-toggle {
                grid-column: 1;
            }

            .activity-type-toggle {
                min-width: 160px;
                height: 36px;
            }
            
            .activity-type-option {
                font-size: 10px;
                padding: 6px 12px;
                min-width: 70px;
                gap: 3px;
            }

            .activity-item.saved {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
                padding: 15px;
            }

            .activity-saved-content {
                width: 100%;
            }

            .activity-saved-emoji {
                width: 45px;
                height: 45px;
                font-size: 22px;
            }

            .activity-saved-name {
                font-size: var(--text-sm);
            }

            .activity-saved-meta {
                flex-direction: column;
                align-items: flex-start;
                gap: 6px;
            }

            .activity-actions {
                width: 100%;
                justify-content: space-between;
            }

            .edit-btn, .save-btn {
                font-size: 11px;
                padding: 6px 12px;
            }
        }
    </style>
</head>
<body>
    <!-- Background Clothing Animation for Auth Screen -->
    <div id="authBgAnimation" class="auth-bg-animation"></div>

    <!-- Auth Screen -->
    <div id="authScreen" class="auth-screen">
        <div class="auth-logo" onclick="window.location.reload()">
            <svg width="180" height="60" viewBox="0 0 180 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                <text x="0" y="48" font-family="'Nunito', 'Arial Rounded MT Bold', sans-serif" 
                      font-size="54" font-weight="800" fill="#A8D05F" letter-spacing="-1.5">
                    qepi.
                </text>
            </svg>
        </div>
        <h2 id="authTitle">Pack Smarter.</h2>
        <div class="form-group">
            <label id="nameLabel" for="name">Name</label>
            <input type="text" id="name" placeholder="Enter your name">
        </div>
        <div class="form-group">
            <label id="usernameLabel" for="username">Username</label>
            <input type="text" id="username" placeholder="Enter username">
        </div>
        <div class="form-group">
            <label id="passwordLabel" for="password">Password</label>
            <input type="password" id="password" placeholder="Enter password">
        </div>
        <button class="btn" id="loginBtn">Login</button>
        <button class="btn btn-secondary" id="registerBtn">Register</button>
        <div style="text-align: center; margin-top: 20px;">
            <button class="lang-selector" onclick="toggleLanguage()">ES/EN</button>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="app-layout hidden">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-logo" onclick="showLandingPage()">
                <svg width="95" height="35" viewBox="0 0 95 35" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <text x="0" y="28" font-family="'Nunito', 'Arial Rounded MT Bold', sans-serif" 
                          font-size="32" font-weight="800" fill="#A8D05F" letter-spacing="-1">
                        qepi.
                    </text>
                </svg>
            </div>
            <div class="sidebar-profile">
                <div class="sidebar-profile-pic" id="sidebarProfilePic">👤</div>
                <div class="sidebar-profile-info">
                    <h3 id="currentUser"></h3>
                </div>
            </div>

            <button class="new-trip-btn" onclick="showNewTripForm()">+ <span id="newTripBtnText">New Trip</span></button>

            <div class="sidebar-section">
                <div class="sidebar-section-title" id="upcomingTripsSidebarTitle">UPCOMING TRIPS</div>
                <div class="sidebar-trips-list" id="sidebarTripsList"></div>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-section-title" id="pastTripsSidebarTitle">PAST TRIPS</div>
                <div class="sidebar-trips-list" id="sidebarPastTripsList"></div>
            </div>

            <div class="sidebar-language">
                <button class="lang-btn" onclick="toggleLanguage()">
                    <span class="icon">🌐</span>
                    <span id="langBtnText">ES / EN</span>
                </button>
            </div>

            <div class="sidebar-logout">
                <button class="logout-btn" id="logoutBtn">
                    <span class="icon">🚪</span>
                    <span id="logoutBtnText">Logout</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="container">
                <!-- Landing Page -->
                <div id="landingPage">
                    <!-- Page Header -->
                    <div class="page-header">
                        <h1 class="greeting"><span id="greetingText">Good Morning</span>, <span id="userFirstName">Traveler</span> <span class="greeting-wave">👋</span></h1>
                    </div>

                    <!-- API Setup Banner -->
                    <div id="apiBanner" class="api-banner" style="display: none;">
                        <div class="api-banner-icon">🌤️</div>
                        <div class="api-banner-content">
                            <h4 id="apiBannerTitle">Enable Real Weather Data</h4>
                            <p id="apiBannerText">Get a free API key from <a href="https://www.weatherapi.com/signup.aspx" target="_blank" class="api-banner-link">WeatherAPI.com</a> and add it to line 1731 of the code to see real weather forecasts for your trips!</p>
                        </div>
                        <button class="api-banner-close" onclick="closeApiBanner()" title="Dismiss">×</button>
                    </div>

                <!-- New Trip Form -->
                <div class="trip-form">
                    <h2 id="createTripTitle">Create New Trip</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label id="destinationLabel">Destination</label>
                            <div class="autocomplete-container">
                                <input type="text" id="destination" placeholder="Where are you going?" autocomplete="off">
                                <div id="autocompleteSuggestions" class="autocomplete-suggestions"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label id="dateRangeLabel">Select Travel Dates</label>
                            <button type="button" class="date-picker-button" id="datePickerButton" onclick="openCalendar()">
                                <span id="datePickerButtonText">Click to select dates</span>
                                <span>📅</span>
                            </button>
                        </div>
                    </div>
                    <button class="btn" id="createTripBtn">Create Trip</button>
                </div>

                    <!-- Upcoming Trips -->
                    <div class="trips-section">
                        <div class="trips-section-header">
                            <h2 id="upcomingTripsTitle">Upcoming trips</h2>
                            <a href="#" class="view-details-link" id="viewDetailsLink">Details</a>
                        </div>
                        <div class="trips-grid" id="upcomingTrips"></div>
                    </div>

                    <!-- Past Trips -->
                    <div class="trips-section">
                        <h2 id="pastTripsTitle">Past Trips</h2>
                        <div class="past-trips-grid" id="pastTrips"></div>
                    </div>
                </div>

            <!-- Trip Detail Page -->
            <div id="tripDetailPage" class="hidden">
                <div class="trip-detail">
                    <button class="back-btn" onclick="showLandingPage()">← <span id="backBtnText">Back to Trips</span></button>
                    
                    <!-- Trip Header -->
                    <div class="trip-header-compact">
                        <div class="trip-header-top">
                            <div class="trip-icon" id="tripIcon">T</div>
                            <input type="text" class="trip-name-inline" id="tripName" placeholder="Trip Name">
                            <div class="trip-duration-badge" id="tripDurationBadge">4 days</div>
                            <div class="trip-socket-inline" id="tripSocketInline">Type C/I • 220V</div>
                            <button class="delete-trip-btn" onclick="deleteTrip()">🗑️ <span id="deleteTripText">Delete</span></button>
                        </div>
                        <div class="trip-subtitle-inline" id="tripSubtitleInline"></div>
                    </div>

                    <!-- Notes Section -->
                    <div class="notes-section">
                        <h3 id="notesTitle">Notes</h3>
                        <textarea class="trip-notes" id="tripNotes" placeholder="Quick trip notes..." oninput="saveCurrentTrip()"></textarea>
                    </div>

                    <!-- Activities -->
                    <div class="activities-section">
                        <div class="activities-header">
                            <h3 id="activitiesTitle">Activities</h3>
                            <button class="add-activity-link" onclick="addActivity()"><span id="addActivityText">Add Activity</span></button>
                        </div>
                        <div class="activities-list" id="activitiesList">
                            <p class="no-activities" id="noActivitiesText">No activities yet.</p>
                        </div>
                    </div>
                </div>

                <!-- Checklists -->
                <div class="checklists-header-section">
                    <button class="add-list-btn" id="addCustomListBtn" onclick="toggleCustomList()" style="display: inline-flex;">
                        + <span id="addListBtnText">Add List</span>
                    </button>
                </div>
                <div class="checklists-section" id="checklistsSection">
                    <div class="checklist-column">
                        <div class="checklist-header">
                            <h3 id="essentialsTitle">Essentials</h3>
                        </div>
                        <div class="checklist-items" id="essentialsList"></div>
                        <button class="add-btn" onclick="addChecklistItem('essentials')">+ <span id="addItemText1">Add Item</span></button>
                    </div>

                    <div class="checklist-column">
                        <div class="checklist-header">
                            <h3 id="toiletriesTitle">Toiletries & Wellness</h3>
                        </div>
                        <div class="checklist-items" id="toiletriesList"></div>
                        <button class="add-btn" onclick="addChecklistItem('toiletries')">+ <span id="addItemText2">Add Item</span></button>
                    </div>

                    <div class="checklist-column" id="customListColumn" style="display: none;">
                        <div class="checklist-header">
                            <h3><input type="text" id="customListName" placeholder="Custom List" oninput="saveCurrentTrip()"></h3>
                        </div>
                        <div class="checklist-items" id="customList"></div>
                        <button class="add-btn" onclick="addChecklistItem('custom')">+ <span id="addItemText3">Add Item</span></button>
                    </div>
                </div>

                <!-- Outfit Planner -->
                <div class="outfit-planner">
                    <h3 id="outfitPlannerTitle">Outfit Planner</h3>
                    <div id="outfitPlannerContent"></div>
                </div>
            </div>
        </div>

                </div>
            </main>
        </div>

        <!-- Date Range Picker Modal -->
        <div id="dateRangePicker" class="date-range-picker hidden">
            <div class="calendar-header">
                <button type="button" onclick="changeMonth(-1)">←</button>
                <h4 id="calendarMonth"></h4>
                <button type="button" onclick="changeMonth(1)">→</button>
            </div>
            <div class="calendar-weekdays" id="calendarWeekdays"></div>
            <div class="calendar-days" id="calendarDays"></div>
            <div class="selected-dates-display">
                <p id="selectedDatesText">Select start and end dates</p>
                <p class="date-range" id="selectedDatesRange"></p>
            </div>
            <button class="btn calendar-close-btn" id="calendarDoneBtn" onclick="closeCalendar()">Done</button>
        </div>

        <!-- Emoji Picker -->
        <div id="emojiPicker" class="emoji-picker hidden">
            <h3 style="margin-bottom: 15px;">Select Emoji</h3>
            <div class="emoji-grid" id="emojiGrid"></div>
            <button class="btn" onclick="closeEmojiPicker()">Close</button>
        </div>
        <div id="overlay" class="overlay hidden" onclick="closeOverlay()"></div>

        <!-- Activity Modal -->
        <div id="activityModal" class="activity-modal hidden">
            <div class="activity-modal-content">
                <div class="activity-modal-header">
                    <h3 id="activityModalTitle">Add Activity</h3>
                    <button class="activity-modal-close" onclick="closeActivityModal()">×</button>
                </div>
                
                <div class="activity-modal-body">
                    <div class="form-group">
                        <label id="activityNameLabel">Activity Name</label>
                        <input type="text" id="activityNameInput" placeholder="Enter activity name">
                    </div>
                    
                    <div class="form-group">
                        <label id="activityEmojiLabel">Emoji</label>
                        <button type="button" class="activity-emoji-button" id="activityEmojiButton" onclick="openEmojiPickerForActivity()">
                            <span id="activityEmojiDisplay">🎯</span>
                        </button>
                    </div>
                    
                    <div class="form-group">
                        <label id="activityDateLabel">Date</label>
                        <button type="button" class="activity-date-button" id="activityDateButton" onclick="openCalendarForActivity()">
                            <span id="activityDateDisplay">Select date</span>
                            <span>📅</span>
                        </button>
                    </div>
                    
                    <div class="form-group">
                        <label id="activityTypeLabel">Time of Day</label>
                        <div class="activity-toggle">
                            <button class="activity-toggle-btn active" data-type="day" onclick="selectActivityType('day')">
                                <span>☀️</span>
                                <span id="activityDayLabel">Day</span>
                            </button>
                            <button class="activity-toggle-btn" data-type="night" onclick="selectActivityType('night')">
                                <span>🌙</span>
                                <span id="activityNightLabel">Night</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="activity-modal-footer">
                    <button class="btn btn-secondary" onclick="closeActivityModal()" id="activityCancelBtn">Cancel</button>
                    <button class="btn" onclick="saveActivityFromModal()" id="activitySaveBtn">Add Activity</button>
                </div>
            </div>
        </div>

        <!-- Emoji Picker Modal -->
        <div id="emojiPickerModal" class="emoji-picker-modal hidden">
            <div class="emoji-picker-content">
                <div class="emoji-picker-header">
                    <h3 id="emojiPickerTitle">Choose an Emoji</h3>
                    <button class="emoji-picker-close" onclick="closeEmojiPicker()">×</button>
                </div>
                <div class="emoji-picker-search">
                    <input type="text" id="emojiSearchInput" placeholder="Search emojis..." oninput="searchEmojis(this.value)">
                </div>
                <div class="emoji-picker-categories">
                    <button class="emoji-category-btn active" data-category="all" onclick="filterEmojiCategory('all')">🌟 All</button>
                    <button class="emoji-category-btn" data-category="smileys" onclick="filterEmojiCategory('smileys')">😀 Smileys</button>
                    <button class="emoji-category-btn" data-category="animals" onclick="filterEmojiCategory('animals')">🐶 Animals</button>
                    <button class="emoji-category-btn" data-category="food" onclick="filterEmojiCategory('food')">🍕 Food</button>
                    <button class="emoji-category-btn" data-category="activities" onclick="filterEmojiCategory('activities')">⚽ Activities</button>
                    <button class="emoji-category-btn" data-category="travel" onclick="filterEmojiCategory('travel')">✈️ Travel</button>
                    <button class="emoji-category-btn" data-category="objects" onclick="filterEmojiCategory('objects')">💡 Objects</button>
                    <button class="emoji-category-btn" data-category="symbols" onclick="filterEmojiCategory('symbols')">❤️ Symbols</button>
                    <button class="emoji-category-btn" data-category="flags" onclick="filterEmojiCategory('flags')">🏁 Flags</button>
                </div>
                <div class="emoji-picker-grid" id="emojiPickerGrid">
                    <!-- Emojis will be populated here -->
                </div>
            </div>
        </div>

        <!-- Activity Date Picker Modal -->
        <div id="activityDatePicker" class="activity-date-picker hidden">
            <div class="calendar-header">
                <h4 id="activityDatePickerTitle">Select Date</h4>
                <button class="calendar-close-icon" onclick="closeActivityDatePicker()">×</button>
            </div>
            <div class="calendar-nav">
                <button onclick="changeActivityMonth(-1)">←</button>
                <span id="activityMonthYear"></span>
                <button onclick="changeActivityMonth(1)">→</button>
            </div>
            <div class="calendar-weekdays">
                <div class="calendar-weekday">S</div>
                <div class="calendar-weekday">M</div>
                <div class="calendar-weekday">T</div>
                <div class="calendar-weekday">W</div>
                <div class="calendar-weekday">T</div>
                <div class="calendar-weekday">F</div>
                <div class="calendar-weekday">S</div>
            </div>
            <div class="calendar-days" id="activityCalendarDays">
                <!-- Days will be populated here -->
            </div>
        </div>
    </div>

    <script>
        // Language translations
        const translations = {
            en: {
                authTitle: "Pack Smarter.",
                nameLabel: "Name",
                namePlaceholder: "Enter your name",
                usernameLabel: "Username",
                usernamePlaceholder: "Enter username",
                passwordLabel: "Password",
                passwordPlaceholder: "Enter password",
                loginBtn: "Login",
                registerBtn: "Register",
                logoutBtn: "Logout",
                appTitle: "🧳 Packing Planner",
                createTripTitle: "Create New Trip",
                destinationLabel: "Destination",
                startDateLabel: "Start Date",
                endDateLabel: "End Date",
                createTripBtn: "Create Trip",
                upcomingTripsTitle: "Upcoming trips",
                pastTripsTitle: "Past trips",
                backBtnText: "Back to Trips",
                startLabel: "Start Date",
                endLabel: "End Date",
                durationLabel: "Duration",
                socketLabel: "Socket Type",
                activitiesTitle: "Activities",
                addActivityText: "Add Activity",
                essentialsTitle: "Essentials",
                toiletriesTitle: "Toiletries & Wellness",
                addItemText1: "Add Item",
                addItemText2: "Add Item",
                addItemText3: "Add Item",
                addListBtnText: "Add List",
                outfitPlannerTitle: "Outfit Planner",
                dateRangeLabel: "Select Travel Dates",
                selectDatesPrompt: "Select start and end dates",
                clickToSelectDates: "Click to select dates",
                calendarDoneBtn: "Done",
                subheadingText: "Plan your itinerary with us",
                viewDetailsLink: "Details",
                notesTitle: "Notes",
                deleteTripText: "Delete",
                noActivitiesText: "No activities yet.",
                dayActivity: "Day",
                nightActivity: "Night",
                days: "days",
                daysLeft: "days left",
                dayOutfit: "Day Outfit",
                nightOutfit: "Night Outfit",
                top: "Top",
                bottom: "Bottom",
                jacket: "Jacket",
                accessory: "Accessory",
                shoes: "Shoes",
                weather: "Weather",
                activities: "Activities",
                week: "Week",
                apiBannerTitle: "Enable Real Weather Data",
                apiBannerText: "Get a free API key from WeatherAPI.com and add it to line 1731 of the code to see real weather forecasts for your trips!",
                upcomingTripsSidebarTitle: "UPCOMING TRIPS",
                pastTripsSidebarTitle: "PAST TRIPS",
                newTripBtnText: "New Trip",
                langBtnText: "ES / EN",
                logoutBtnText: "Logout"
            },
            es: {
                authTitle: "Empaca Mejor.",
                nameLabel: "Nombre",
                namePlaceholder: "Ingresa tu nombre",
                usernameLabel: "Usuario",
                usernamePlaceholder: "Ingresa tu usuario",
                passwordLabel: "Contraseña",
                passwordPlaceholder: "Ingresa tu contraseña",
                loginBtn: "Iniciar Sesión",
                registerBtn: "Registrarse",
                logoutBtn: "Cerrar Sesión",
                appTitle: "🧳 Planificador de Maletas",
                createTripTitle: "Crear Nuevo Viaje",
                destinationLabel: "Destino",
                startDateLabel: "Fecha de Inicio",
                endDateLabel: "Fecha de Fin",
                createTripBtn: "Crear Viaje",
                upcomingTripsTitle: "Próximos viajes",
                pastTripsTitle: "Viajes pasados",
                backBtnText: "Volver a Viajes",
                startLabel: "Fecha Inicio",
                endLabel: "Fecha Fin",
                durationLabel: "Duración",
                socketLabel: "Tipo de Enchufe",
                activitiesTitle: "Actividades",
                addActivityText: "Añadir Actividad",
                essentialsTitle: "Esenciales",
                toiletriesTitle: "Aseo y Bienestar",
                addItemText1: "Añadir Artículo",
                addItemText2: "Añadir Artículo",
                addItemText3: "Añadir Artículo",
                addListBtnText: "Añadir Lista",
                outfitPlannerTitle: "Planificador de Ropa",
                dateRangeLabel: "Seleccionar Fechas de Viaje",
                selectDatesPrompt: "Seleccione fechas de inicio y fin",
                clickToSelectDates: "Haga clic para seleccionar fechas",
                calendarDoneBtn: "Listo",
                subheadingText: "Planifica tu itinerario con nosotros",
                viewDetailsLink: "Detalles",
                notesTitle: "Notas",
                deleteTripText: "Eliminar",
                noActivitiesText: "No hay actividades aún.",
                dayActivity: "Día",
                nightActivity: "Noche",
                days: "días",
                daysLeft: "días restantes",
                dayOutfit: "Outfit de Día",
                nightOutfit: "Outfit de Noche",
                top: "Superior",
                bottom: "Inferior",
                jacket: "Chaqueta",
                accessory: "Accesorio",
                shoes: "Zapatos",
                weather: "Clima",
                activities: "Actividades",
                week: "Semana",
                apiBannerTitle: "Activar Datos Meteorológicos Reales",
                apiBannerText: "Obtenga una clave API gratuita de WeatherAPI.com y agréguela en la línea 1731 del código para ver pronósticos meteorológicos reales para sus viajes!",
                upcomingTripsSidebarTitle: "PRÓXIMOS VIAJES",
                pastTripsSidebarTitle: "VIAJES PASADOS",
                newTripBtnText: "Nuevo Viaje",
                langBtnText: "ES / EN",
                logoutBtnText: "Cerrar Sesión"
            }
        };

        let currentLanguage = localStorage.getItem('language') || 'en';
        let currentUser = null;
        let currentTrip = null;
        let selectedActivityIndex = null;
        let selectedActivityDate = '';
        let selectedActivityType = 'day';
        let selectedActivityEmoji = '🎯';
        let activityModalSource = ''; // 'planner' or 'info'
        let isActivityCalendarOpen = false;
        let emojiPickerContext = null; // 'trip' or 'activity'
        let selectedStartDate = null;
        let selectedEndDate = null;
        let currentCalendarMonth = new Date();
        let isSelectingRange = false;
        let activityDatePickerMonth = new Date();
        let selectedActivityIndexForDate = null;
        let selectedActivityDateValue = null;

        // Socket types by country/region (legacy, kept for reference)
        const socketTypes = {
            'usa': 'Type A/B',
            'uk': 'Type G',
            'europe': 'Type C/F',
            'australia': 'Type I',
            'china': 'Type A/I',
            'japan': 'Type A/B',
            'india': 'Type D/M',
            'default': 'Type C/F'
        };

        // Get country flag emoji based on destination
        function getCountryFlagEmoji(destination) {
            const dest = destination.toLowerCase();
            
            // Country name to flag emoji mapping
            const flagMap = {
                // North America
                'usa': '🇺🇸', 'united states': '🇺🇸', 'america': '🇺🇸',
                'canada': '🇨🇦',
                'mexico': '🇲🇽',
                'costa rica': '🇨🇷',
                'panama': '🇵🇦',
                'jamaica': '🇯🇲',
                'bahamas': '🇧🇸',
                'barbados': '🇧🇧',
                
                // Europe
                'uk': '🇬🇧', 'united kingdom': '🇬🇧', 'england': '🇬🇧', 'scotland': '🇬🇧', 'wales': '🇬🇧',
                'france': '🇫🇷', 'paris': '🇫🇷',
                'spain': '🇪🇸', 'madrid': '🇪🇸', 'barcelona': '🇪🇸',
                'italy': '🇮🇹', 'rome': '🇮🇹', 'milan': '🇮🇹', 'venice': '🇮🇹',
                'germany': '🇩🇪', 'berlin': '🇩🇪', 'munich': '🇩🇪',
                'portugal': '🇵🇹', 'lisbon': '🇵🇹',
                'netherlands': '🇳🇱', 'amsterdam': '🇳🇱',
                'belgium': '🇧🇪', 'brussels': '🇧🇪',
                'switzerland': '🇨🇭',
                'austria': '🇦🇹', 'vienna': '🇦🇹',
                'greece': '🇬🇷', 'athens': '🇬🇷',
                'ireland': '🇮🇪', 'dublin': '🇮🇪',
                'poland': '🇵🇱',
                'czech': '🇨🇿', 'prague': '🇨🇿',
                'sweden': '🇸🇪', 'stockholm': '🇸🇪',
                'norway': '🇳🇴', 'oslo': '🇳🇴',
                'denmark': '🇩🇰', 'copenhagen': '🇩🇰',
                'finland': '🇫🇮', 'helsinki': '🇫🇮',
                'iceland': '🇮🇸', 'reykjavik': '🇮🇸',
                'croatia': '🇭🇷',
                'hungary': '🇭🇺', 'budapest': '🇭🇺',
                'romania': '🇷🇴',
                'turkey': '🇹🇷', 'istanbul': '🇹🇷',
                
                // South America
                'brazil': '🇧🇷', 'sao paulo': '🇧🇷', 'rio': '🇧🇷',
                'argentina': '🇦🇷', 'buenos aires': '🇦🇷',
                'chile': '🇨🇱', 'santiago': '🇨🇱',
                'peru': '🇵🇪', 'lima': '🇵🇪',
                'colombia': '🇨🇴', 'bogota': '🇨🇴',
                'ecuador': '🇪🇨', 'quito': '🇪🇨',
                'bolivia': '🇧🇴',
                'uruguay': '🇺🇾', 'montevideo': '🇺🇾',
                'venezuela': '🇻🇪', 'caracas': '🇻🇪',
                'paraguay': '🇵🇾',
                
                // Asia
                'japan': '🇯🇵', 'tokyo': '🇯🇵', 'osaka': '🇯🇵', 'kyoto': '🇯🇵',
                'china': '🇨🇳', 'beijing': '🇨🇳', 'shanghai': '🇨🇳',
                'south korea': '🇰🇷', 'korea': '🇰🇷', 'seoul': '🇰🇷',
                'india': '🇮🇳', 'delhi': '🇮🇳', 'mumbai': '🇮🇳', 'bangalore': '🇮🇳',
                'thailand': '🇹🇭', 'bangkok': '🇹🇭',
                'vietnam': '🇻🇳', 'hanoi': '🇻🇳', 'ho chi minh': '🇻🇳',
                'singapore': '🇸🇬',
                'malaysia': '🇲🇾', 'kuala lumpur': '🇲🇾',
                'indonesia': '🇮🇩', 'bali': '🇮🇩', 'jakarta': '🇮🇩',
                'philippines': '🇵🇭', 'manila': '🇵🇭',
                'hong kong': '🇭🇰',
                'taiwan': '🇹🇼', 'taipei': '🇹🇼',
                
                // Middle East
                'dubai': '🇦🇪', 'uae': '🇦🇪', 'emirates': '🇦🇪',
                'qatar': '🇶🇦', 'doha': '🇶🇦',
                'saudi': '🇸🇦', 'riyadh': '🇸🇦',
                'israel': '🇮🇱', 'tel aviv': '🇮🇱', 'jerusalem': '🇮🇱',
                'kuwait': '🇰🇼',
                'bahrain': '🇧🇭',
                'oman': '🇴🇲',
                
                // Oceania
                'australia': '🇦🇺', 'sydney': '🇦🇺', 'melbourne': '🇦🇺',
                'new zealand': '🇳🇿', 'auckland': '🇳🇿', 'wellington': '🇳🇿',
                
                // Africa
                'south africa': '🇿🇦', 'cape town': '🇿🇦', 'johannesburg': '🇿🇦',
                'egypt': '🇪🇬', 'cairo': '🇪🇬',
                'morocco': '🇲🇦', 'marrakech': '🇲🇦',
                'kenya': '🇰🇪', 'nairobi': '🇰🇪',
                'tanzania': '🇹🇿',
                'nigeria': '🇳🇬'
            };
            
            // Check for exact or partial matches
            for (let key in flagMap) {
                if (dest.includes(key)) {
                    return flagMap[key];
                }
            }
            
            // Default to world emoji if no match
            return '🌍';
        }

        // Get voltage by socket type
        function getVoltage(socketType) {
            if (socketType.includes('A/B') && socketType.includes('110')) return '110V';
            if (socketType.includes('A/B')) return '100-110V';
            if (socketType.includes('G')) return '230V';
            if (socketType.includes('C/F')) return '220-230V';
            if (socketType.includes('C/I')) return '220V';
            if (socketType.includes('I')) return '230V';
            if (socketType.includes('A/I')) return '220V';
            if (socketType.includes('D/M')) return '230V';
            if (socketType.includes('A/C')) return '220V';
            if (socketType.includes('C/G')) return '220-240V';
            if (socketType.includes('M')) return '230V';
            if (socketType.includes('C/H')) return '230V';
            return '220V';
        }

        // Get SVG icon for socket type
        function getSocketSVG(socketType) {
            const svgStyle = 'display: inline-block; vertical-align: middle; margin-right: 6px;';
            
            // Type A/B - North American (flat parallel blades)
            if (socketType.includes('A/B')) {
                return `<svg width="18" height="18" viewBox="0 0 24 24" style="${svgStyle}" fill="none">
                    <rect x="5" y="3" width="14" height="18" rx="2" fill="#666" stroke="#444" stroke-width="1"/>
                    <rect x="9" y="7" width="2" height="6" rx="0.5" fill="#FFD700"/>
                    <rect x="13" y="7" width="2" height="6" rx="0.5" fill="#FFD700"/>
                    <circle cx="12" cy="16" r="1.5" fill="#888"/>
                </svg>`;
            }
            
            // Type C/F - European (two round pins)
            if (socketType.includes('C/F')) {
                return `<svg width="18" height="18" viewBox="0 0 24 24" style="${svgStyle}" fill="none">
                    <rect x="5" y="3" width="14" height="18" rx="2" fill="#666" stroke="#444" stroke-width="1"/>
                    <circle cx="9.5" cy="11" r="2" fill="#FFD700"/>
                    <circle cx="14.5" cy="11" r="2" fill="#FFD700"/>
                    <rect x="6" y="16" width="12" height="3" rx="1" fill="#888"/>
                </svg>`;
            }
            
            // Type G - UK (three rectangular pins)
            if (socketType.includes('G')) {
                return `<svg width="18" height="18" viewBox="0 0 24 24" style="${svgStyle}" fill="none">
                    <rect x="5" y="3" width="14" height="18" rx="2" fill="#666" stroke="#444" stroke-width="1"/>
                    <rect x="9" y="6" width="1.5" height="5" rx="0.5" fill="#FFD700"/>
                    <rect x="13.5" y="6" width="1.5" height="5" rx="0.5" fill="#FFD700"/>
                    <rect x="10.75" y="13" width="2.5" height="6" rx="0.5" fill="#FFD700"/>
                </svg>`;
            }
            
            // Type I - Australian (angled flat pins)
            if (socketType.includes('I')) {
                return `<svg width="18" height="18" viewBox="0 0 24 24" style="${svgStyle}" fill="none">
                    <rect x="5" y="3" width="14" height="18" rx="2" fill="#666" stroke="#444" stroke-width="1"/>
                    <rect x="8" y="8" width="2.5" height="5" rx="0.5" fill="#FFD700" transform="rotate(-15 9.25 10.5)"/>
                    <rect x="13.5" y="8" width="2.5" height="5" rx="0.5" fill="#FFD700" transform="rotate(15 14.75 10.5)"/>
                    <circle cx="12" cy="16" r="1.5" fill="#888"/>
                </svg>`;
            }
            
            // Type C/I - South American (mix)
            if (socketType.includes('C/I')) {
                return `<svg width="18" height="18" viewBox="0 0 24 24" style="${svgStyle}" fill="none">
                    <rect x="5" y="3" width="14" height="18" rx="2" fill="#666" stroke="#444" stroke-width="1"/>
                    <circle cx="9.5" cy="10" r="1.8" fill="#FFD700"/>
                    <circle cx="14.5" cy="10" r="1.8" fill="#FFD700"/>
                    <circle cx="12" cy="15" r="1.5" fill="#FFD700"/>
                </svg>`;
            }
            
            // Type D/M - Indian (three round pins)
            if (socketType.includes('D/M')) {
                return `<svg width="18" height="18" viewBox="0 0 24 24" style="${svgStyle}" fill="none">
                    <rect x="5" y="3" width="14" height="18" rx="2" fill="#666" stroke="#444" stroke-width="1"/>
                    <circle cx="8" cy="11" r="1.8" fill="#FFD700"/>
                    <circle cx="16" cy="11" r="1.8" fill="#FFD700"/>
                    <circle cx="12" cy="15" r="1.8" fill="#FFD700"/>
                </svg>`;
            }
            
            // Type A/C - Southeast Asian (mixed)
            if (socketType.includes('A/C')) {
                return `<svg width="18" height="18" viewBox="0 0 24 24" style="${svgStyle}" fill="none">
                    <rect x="5" y="3" width="14" height="18" rx="2" fill="#666" stroke="#444" stroke-width="1"/>
                    <rect x="9" y="8" width="2" height="5" rx="0.5" fill="#FFD700"/>
                    <circle cx="14" cy="10.5" r="1.8" fill="#FFD700"/>
                    <circle cx="12" cy="16" r="1.5" fill="#888"/>
                </svg>`;
            }
            
            // Type C/G - Middle East (hybrid)
            if (socketType.includes('C/G')) {
                return `<svg width="18" height="18" viewBox="0 0 24 24" style="${svgStyle}" fill="none">
                    <rect x="5" y="3" width="14" height="18" rx="2" fill="#666" stroke="#444" stroke-width="1"/>
                    <circle cx="9.5" cy="9" r="1.8" fill="#FFD700"/>
                    <circle cx="14.5" cy="9" r="1.8" fill="#FFD700"/>
                    <rect x="10.5" y="14" width="3" height="5" rx="0.5" fill="#FFD700"/>
                </svg>`;
            }
            
            // Type M - South African (large round pins)
            if (socketType.includes('M')) {
                return `<svg width="18" height="18" viewBox="0 0 24 24" style="${svgStyle}" fill="none">
                    <rect x="5" y="3" width="14" height="18" rx="2" fill="#666" stroke="#444" stroke-width="1"/>
                    <circle cx="8.5" cy="10" r="2.2" fill="#FFD700"/>
                    <circle cx="15.5" cy="10" r="2.2" fill="#FFD700"/>
                    <circle cx="12" cy="16" r="2" fill="#FFD700"/>
                </svg>`;
            }
            
            // Type C/H - Israeli
            if (socketType.includes('C/H')) {
                return `<svg width="18" height="18" viewBox="0 0 24 24" style="${svgStyle}" fill="none">
                    <rect x="5" y="3" width="14" height="18" rx="2" fill="#666" stroke="#444" stroke-width="1"/>
                    <circle cx="9.5" cy="10" r="1.8" fill="#FFD700"/>
                    <circle cx="14.5" cy="10" r="1.8" fill="#FFD700"/>
                    <rect x="10.5" y="14" width="3" height="4" rx="0.5" fill="#FFD700"/>
                </svg>`;
            }
            
            // Default - Generic plug icon
            return `<svg width="18" height="18" viewBox="0 0 24 24" style="${svgStyle}" fill="none">
                <rect x="5" y="3" width="14" height="18" rx="2" fill="#666" stroke="#444" stroke-width="1"/>
                <circle cx="9.5" cy="11" r="2" fill="#FFD700"/>
                <circle cx="14.5" cy="11" r="2" fill="#FFD700"/>
            </svg>`;
        }

        // API Configuration
        // Get your free API key from: https://www.weatherapi.com/signup.aspx
        const WEATHER_API_KEY = '5cbc52962baf424c9ec174311252310'; // Your WeatherAPI.com API key
        const WEATHER_API_URL = 'https://api.weatherapi.com/v1/forecast.json';

        // Async function to fetch country data for socket information
        async function fetchCountryData(destination) {
            try {
                // Try to extract country name from destination
                const countryQuery = destination.split(',').pop().trim();
                const response = await fetch(`https://restcountries.com/v3.1/name/${countryQuery}?fields=name,cca2,voltage,plugs`);
                
                if (!response.ok) {
                    throw new Error('Country not found');
                }
                
                const data = await response.json();
                if (data && data.length > 0) {
                    const country = data[0];
                    return {
                        countryCode: country.cca2,
                        voltage: country.voltage || 'Unknown',
                        plugTypes: country.plugs ? country.plugs.join('/') : 'Check local'
                    };
                }
            } catch (error) {
                console.log('Could not fetch country data:', error);
            }
            return null;
        }

        // Async function to fetch weather forecast
        async function fetchWeatherForecast(destination, startDate, endDate) {
            if (!WEATHER_API_KEY || WEATHER_API_KEY === 'YOUR_WEATHER_API_KEY_HERE') {
                console.log('Weather API key not configured. Using mock data.');
                return null;
            }

            try {
                const start = new Date(startDate);
                const end = new Date(endDate);
                const days = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
                
                // WeatherAPI.com free tier allows up to 3 days forecast
                const forecastDays = Math.min(days, 3);
                
                const response = await fetch(
                    `${WEATHER_API_URL}?key=${WEATHER_API_KEY}&q=${encodeURIComponent(destination)}&days=${forecastDays}&aqi=no&alerts=no`
                );
                
                if (!response.ok) {
                    throw new Error('Weather fetch failed');
                }
                
                const data = await response.json();
                return data;
            } catch (error) {
                console.log('Could not fetch weather data:', error);
                return null;
            }
        }

        // Helper function to get weather icon emoji
        function getWeatherEmoji(condition) {
            const text = condition.toLowerCase();
            if (text.includes('sun') || text.includes('clear')) return '☀️';
            if (text.includes('cloud')) return '☁️';
            if (text.includes('rain')) return '🌧️';
            if (text.includes('storm') || text.includes('thunder')) return '⛈️';
            if (text.includes('snow')) return '❄️';
            if (text.includes('fog') || text.includes('mist')) return '🌫️';
            if (text.includes('wind')) return '💨';
            return '🌤️';
        }

        // Helper function to format weather data
        function formatWeatherData(weatherData, dateStr) {
            if (!weatherData || !weatherData.forecast || !weatherData.forecast.forecastday) {
                return '☀️ 72°F';
            }

            const forecastDay = weatherData.forecast.forecastday.find(day => day.date === dateStr);
            if (!forecastDay) {
                // Use the last available forecast day as fallback
                const lastDay = weatherData.forecast.forecastday[weatherData.forecast.forecastday.length - 1];
                if (lastDay) {
                    const emoji = getWeatherEmoji(lastDay.day.condition.text);
                    const tempF = Math.round(lastDay.day.avgtemp_f);
                    const tempC = Math.round(lastDay.day.avgtemp_c);
                    return `${emoji} ${tempF}°F / ${tempC}°C`;
                }
                return '☀️ 72°F';
            }

            const emoji = getWeatherEmoji(forecastDay.day.condition.text);
            const tempF = Math.round(forecastDay.day.avgtemp_f);
            const tempC = Math.round(forecastDay.day.avgtemp_c);
            return `${emoji} ${tempF}°F / ${tempC}°C`;
        }

        // Autocomplete functionality
        let autocompleteTimer = null;
        let currentSuggestions = [];
        let selectedSuggestionIndex = -1;

        async function fetchCitySuggestions(query) {
            if (!query || query.length < 3) {
                return [];
            }

            try {
                const response = await fetch(
                    `https://api.weatherapi.com/v1/search.json?key=${WEATHER_API_KEY}&q=${encodeURIComponent(query)}`
                );
                
                if (!response.ok) {
                    throw new Error('Failed to fetch suggestions');
                }
                
                const data = await response.json();
                return data;
            } catch (error) {
                console.log('Could not fetch city suggestions:', error);
                return [];
            }
        }

        function handleDestinationInput(e) {
            const query = e.target.value.trim();
            
            // Clear previous timer
            if (autocompleteTimer) {
                clearTimeout(autocompleteTimer);
            }
            
            // Hide suggestions if query is too short
            if (query.length < 3) {
                hideAutocompleteSuggestions();
                return;
            }
            
            // Show loading state
            showAutocompleteSuggestions([{ loading: true }]);
            
            // Debounce API calls (wait 300ms after user stops typing)
            autocompleteTimer = setTimeout(async () => {
                const suggestions = await fetchCitySuggestions(query);
                currentSuggestions = suggestions;
                showAutocompleteSuggestions(suggestions);
            }, 300);
        }

        function handleDestinationFocus(e) {
            const query = e.target.value.trim();
            if (query.length >= 3 && currentSuggestions.length > 0) {
                showAutocompleteSuggestions(currentSuggestions);
            }
        }

        function handleDestinationKeydown(e) {
            const container = document.getElementById('autocompleteSuggestions');
            const items = container.querySelectorAll('.autocomplete-item');
            
            if (items.length === 0) return;
            
            // Arrow Down
            if (e.key === 'ArrowDown') {
                e.preventDefault();
                selectedSuggestionIndex = Math.min(selectedSuggestionIndex + 1, items.length - 1);
                updateSelectedSuggestion(items);
            }
            // Arrow Up
            else if (e.key === 'ArrowUp') {
                e.preventDefault();
                selectedSuggestionIndex = Math.max(selectedSuggestionIndex - 1, -1);
                updateSelectedSuggestion(items);
            }
            // Enter
            else if (e.key === 'Enter' && selectedSuggestionIndex >= 0) {
                e.preventDefault();
                const selectedItem = items[selectedSuggestionIndex];
                selectCity(selectedItem.dataset.name, selectedItem.dataset.region, selectedItem.dataset.country);
            }
            // Escape
            else if (e.key === 'Escape') {
                hideAutocompleteSuggestions();
            }
        }

        function updateSelectedSuggestion(items) {
            items.forEach((item, index) => {
                if (index === selectedSuggestionIndex) {
                    item.style.background = '#f8f9fa';
                    item.scrollIntoView({ block: 'nearest' });
                } else {
                    item.style.background = '';
                }
            });
        }

        function showAutocompleteSuggestions(suggestions) {
            const container = document.getElementById('autocompleteSuggestions');
            
            // Reset selection index
            selectedSuggestionIndex = -1;
            
            if (!suggestions || suggestions.length === 0) {
                container.innerHTML = `
                    <div class="autocomplete-no-results">
                        ${currentLanguage === 'en' ? 'No cities found' : 'No se encontraron ciudades'}
                    </div>
                `;
                container.classList.add('active');
                return;
            }
            
            if (suggestions[0].loading) {
                container.innerHTML = `
                    <div class="autocomplete-loading">
                        ${currentLanguage === 'en' ? 'Searching...' : 'Buscando...'}
                    </div>
                `;
                container.classList.add('active');
                return;
            }
            
            // Clear previous content
            container.innerHTML = '';
            
            // Add each suggestion as a clickable element
            suggestions.forEach(city => {
                const item = document.createElement('div');
                item.className = 'autocomplete-item';
                item.innerHTML = `
                    <div class="autocomplete-item-icon">📍</div>
                    <div class="autocomplete-item-text">
                        <div class="autocomplete-item-name">${city.name}</div>
                        <div class="autocomplete-item-region">${city.region ? city.region + ', ' : ''}${city.country}</div>
                    </div>
                `;
                
                // Store city data as properties
                item.dataset.name = city.name;
                item.dataset.region = city.region || '';
                item.dataset.country = city.country;
                
                // Add click handler
                item.addEventListener('click', function() {
                    selectCity(this.dataset.name, this.dataset.region, this.dataset.country);
                });
                
                container.appendChild(item);
            });
            
            container.classList.add('active');
        }

        function hideAutocompleteSuggestions() {
            const container = document.getElementById('autocompleteSuggestions');
            container.classList.remove('active');
        }

        function selectCity(name, region, country) {
            const fullName = region ? `${name}, ${region}, ${country}` : `${name}, ${country}`;
            document.getElementById('destination').value = fullName;
            hideAutocompleteSuggestions();
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            updateLanguage();
            checkAuth();
            setupEventListeners();
            initializeEmojiPicker();
            
            // Start background animation if on auth screen
            if (!document.getElementById('authScreen').classList.contains('hidden')) {
                startAuthBackgroundAnimation();
            }
        });

        function setupEventListeners() {
            document.getElementById('loginBtn').addEventListener('click', login);
            document.getElementById('registerBtn').addEventListener('click', register);
            document.getElementById('logoutBtn').addEventListener('click', logout);
            document.getElementById('createTripBtn').addEventListener('click', createTrip);
            document.getElementById('tripName').addEventListener('input', saveCurrentTrip);
            
            // Autocomplete for destination
            const destinationInput = document.getElementById('destination');
            destinationInput.addEventListener('input', handleDestinationInput);
            destinationInput.addEventListener('focus', handleDestinationFocus);
            destinationInput.addEventListener('keydown', handleDestinationKeydown);
            
            // Close autocomplete when clicking outside
            document.addEventListener('click', function(e) {
                const autocompleteContainer = document.querySelector('.autocomplete-container');
                if (autocompleteContainer && !autocompleteContainer.contains(e.target)) {
                    hideAutocompleteSuggestions();
                }
            });
        }

        function checkAuth() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = savedUser;
                showMainApp();
            }
        }

        function login() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;

            if (!username || !password) {
                alert(currentLanguage === 'en' ? 'Please enter username and password' : 'Por favor ingrese usuario y contraseña');
                return;
            }

            const users = JSON.parse(localStorage.getItem('users') || '{}');
            
            if (users[username] && users[username].password === password) {
                currentUser = username;
                localStorage.setItem('currentUser', username);
                showMainApp();
            } else {
                alert(currentLanguage === 'en' ? 'Invalid credentials' : 'Credenciales inválidas');
            }
            
            // Clear the name field after login
            document.getElementById('name').value = '';
        }

        function register() {
            const name = document.getElementById('name').value.trim();
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;

            if (!name || !username || !password) {
                alert(currentLanguage === 'en' ? 'Please enter name, username and password' : 'Por favor ingrese nombre, usuario y contraseña');
                return;
            }

            const users = JSON.parse(localStorage.getItem('users') || '{}');
            
            if (users[username]) {
                alert(currentLanguage === 'en' ? 'Username already exists' : 'El usuario ya existe');
                return;
            }

            users[username] = { name: name, password: password, trips: [] };
            localStorage.setItem('users', JSON.stringify(users));
            
            alert(currentLanguage === 'en' ? 'Registration successful! Please login.' : '¡Registro exitoso! Por favor inicie sesión.');
            
            // Clear form fields after successful registration
            document.getElementById('name').value = '';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            document.getElementById('authScreen').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('name').value = '';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            
            // Restart background animation
            startAuthBackgroundAnimation();
        }

        function showMainApp() {
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            document.getElementById('currentUser').textContent = currentUser;
            
            // Stop background animation
            stopAuthBackgroundAnimation();
            
            // Get user's stored name
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            const userName = users[currentUser]?.name || currentUser;
            
            // Set profile pictures with user initials from name
            const initials = userName.substring(0, 2).toUpperCase();
            document.getElementById('sidebarProfilePic').textContent = initials;
            
            // Set first name in greeting
            const firstName = userName.split(' ')[0] || userName;
            document.getElementById('userFirstName').textContent = firstName;
            
            initCalendar();
            loadTrips();
            loadSidebarTrips();
            checkApiSetup();
        }

        function checkApiSetup() {
            // Check if API banner has been dismissed
            const bannerDismissed = localStorage.getItem('apiBannerDismissed');
            const apiKeyConfigured = WEATHER_API_KEY && WEATHER_API_KEY !== 'YOUR_WEATHER_API_KEY_HERE';
            
            // Show banner if API key is not configured and banner wasn't dismissed
            if (!apiKeyConfigured && !bannerDismissed) {
                document.getElementById('apiBanner').style.display = 'flex';
            }
        }

        function closeApiBanner() {
            document.getElementById('apiBanner').style.display = 'none';
            localStorage.setItem('apiBannerDismissed', 'true');
        }

        function showNewTripForm() {
            showLandingPage();
            // Scroll to trip form
            document.querySelector('.trip-form').scrollIntoView({ behavior: 'smooth' });
        }

        function loadSidebarTrips() {
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            const trips = users[currentUser]?.trips || [];
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            // Load upcoming trips (trips that haven't ended yet)
            const upcomingContainer = document.getElementById('sidebarTripsList');
            upcomingContainer.innerHTML = '';
            
            const upcoming = trips.filter(t => new Date(t.endDate) >= today)
                .sort((a, b) => new Date(a.startDate) - new Date(b.startDate))
                .slice(0, 4);

            upcoming.forEach(trip => {
                const duration = Math.ceil((new Date(trip.endDate) - new Date(trip.startDate)) / (1000 * 60 * 60 * 24)) + 1;
                const startDate = new Date(trip.startDate);
                const dateStr = `${duration} ${translations[currentLanguage].days}, ${startDate.getDate()} ${startDate.toLocaleDateString(currentLanguage === 'en' ? 'en-US' : 'es-ES', { month: 'short', year: 'numeric' })}`;
                
                const tripEmoji = trip.emoji || getCountryFlagEmoji(trip.destination);
                
                const div = document.createElement('div');
                div.className = 'sidebar-trip-item';
                div.onclick = () => openTrip(trip.id);
                div.innerHTML = `
                    <div class="trip-flag">${tripEmoji}</div>
                    <div class="trip-info">
                        <h4>${trip.destination}</h4>
                        <p>${dateStr}</p>
                    </div>
                `;
                upcomingContainer.appendChild(div);
            });

            if (upcoming.length === 0) {
                upcomingContainer.innerHTML = `<p style="color: #999; font-size: 12px; padding: 10px;">${currentLanguage === 'en' ? 'No upcoming trips' : 'No hay viajes próximos'}</p>`;
            }

            // Load past trips (trips where the end date has passed)
            const pastContainer = document.getElementById('sidebarPastTripsList');
            pastContainer.innerHTML = '';
            
            const past = trips.filter(t => new Date(t.endDate) < today)
                .sort((a, b) => new Date(b.endDate) - new Date(a.endDate))
                .slice(0, 4);

            past.forEach(trip => {
                const startDate = new Date(trip.startDate);
                const dateStr = startDate.toLocaleDateString(currentLanguage === 'en' ? 'en-US' : 'es-ES', { month: 'short', year: 'numeric' });
                
                const tripEmoji = trip.emoji || getCountryFlagEmoji(trip.destination);
                
                const div = document.createElement('div');
                div.className = 'sidebar-trip-item';
                div.onclick = () => openTrip(trip.id);
                div.innerHTML = `
                    <div class="trip-flag" style="opacity: 0.5;">${tripEmoji}</div>
                    <div class="trip-info">
                        <h4>${trip.destination}</h4>
                        <p>${dateStr}</p>
                    </div>
                `;
                pastContainer.appendChild(div);
            });

            if (past.length === 0) {
                pastContainer.innerHTML = `<p style="color: #999; font-size: 12px; padding: 10px;">${currentLanguage === 'en' ? 'No past trips' : 'No hay viajes pasados'}</p>`;
            }
        }

        // Calendar Functions
        function initCalendar() {
            currentCalendarMonth = new Date();
            selectedStartDate = null;
            selectedEndDate = null;
            isSelectingRange = false;
            renderCalendar();
            renderWeekdays();
            updateDatePickerButton();
        }

        function openCalendar() {
            document.getElementById('dateRangePicker').classList.remove('hidden');
            document.getElementById('overlay').classList.remove('hidden');
            renderCalendar();
        }

        function closeCalendar() {
            document.getElementById('dateRangePicker').classList.add('hidden');
            document.getElementById('overlay').classList.add('hidden');
            updateDatePickerButton();
        }

        function updateDatePickerButton() {
            const button = document.getElementById('datePickerButton');
            const buttonText = document.getElementById('datePickerButtonText');
            
            if (!buttonText) return;

            if (selectedStartDate && selectedEndDate) {
                const duration = Math.ceil((new Date(selectedEndDate) - new Date(selectedStartDate)) / (1000 * 60 * 60 * 24)) + 1;
                buttonText.textContent = `${formatDate(selectedStartDate)} → ${formatDate(selectedEndDate)} (${duration} ${translations[currentLanguage].days})`;
                button.classList.add('has-dates');
            } else if (selectedStartDate) {
                buttonText.textContent = formatDate(selectedStartDate);
                button.classList.add('has-dates');
            } else {
                buttonText.textContent = translations[currentLanguage].clickToSelectDates;
                button.classList.remove('has-dates');
            }
        }

        function renderWeekdays() {
            const weekdays = currentLanguage === 'en' 
                ? ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']
                : ['Dom', 'Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb'];
            
            const container = document.getElementById('calendarWeekdays');
            container.innerHTML = weekdays.map(day => 
                `<div class="calendar-weekday">${day}</div>`
            ).join('');
        }

        function renderCalendar() {
            const year = currentCalendarMonth.getFullYear();
            const month = currentCalendarMonth.getMonth();
            
            // Update month display
            const monthNames = currentLanguage === 'en'
                ? ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December']
                : ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
            
            document.getElementById('calendarMonth').textContent = `${monthNames[month]} ${year}`;

            // Get first day of month and number of days
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const prevLastDay = new Date(year, month, 0);
            
            const firstDayOfWeek = firstDay.getDay();
            const daysInMonth = lastDay.getDate();
            const daysInPrevMonth = prevLastDay.getDate();

            const container = document.getElementById('calendarDays');
            container.innerHTML = '';

            const today = new Date();
            today.setHours(0, 0, 0, 0);

            // Previous month's days
            for (let i = firstDayOfWeek - 1; i >= 0; i--) {
                const day = daysInPrevMonth - i;
                const date = new Date(year, month - 1, day);
                container.appendChild(createDayElement(day, date, true));
            }

            // Current month's days
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                container.appendChild(createDayElement(day, date, false));
            }

            // Next month's days to fill the grid
            const totalCells = container.children.length;
            const remainingCells = Math.ceil(totalCells / 7) * 7 - totalCells;
            for (let day = 1; day <= remainingCells; day++) {
                const date = new Date(year, month + 1, day);
                container.appendChild(createDayElement(day, date, true));
            }

            updateSelectedDatesDisplay();
        }

        function createDayElement(day, date, isOtherMonth) {
            const div = document.createElement('div');
            div.className = 'calendar-day';
            div.textContent = day;
            
            if (isOtherMonth) {
                div.classList.add('other-month');
            }

            // Check if it's today
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            if (date.getTime() === today.getTime()) {
                div.classList.add('today');
            }

            // Check if it's selected start or end
            const dateStr = date.toISOString().split('T')[0];
            if (selectedStartDate && dateStr === selectedStartDate) {
                div.classList.add('selected-start');
            }
            if (selectedEndDate && dateStr === selectedEndDate) {
                div.classList.add('selected-end');
            }

            // Check if it's in range
            if (selectedStartDate && selectedEndDate) {
                const startTime = new Date(selectedStartDate).getTime();
                const endTime = new Date(selectedEndDate).getTime();
                const currentTime = date.getTime();
                
                if (currentTime > startTime && currentTime < endTime) {
                    div.classList.add('in-range');
                }
            }

            div.onclick = () => selectDate(dateStr);

            return div;
        }

        function selectDate(dateStr) {
            if (!selectedStartDate || (selectedStartDate && selectedEndDate)) {
                // Start a new selection
                selectedStartDate = dateStr;
                selectedEndDate = null;
                isSelectingRange = true;
            } else if (selectedStartDate && !selectedEndDate) {
                // Complete the selection
                if (new Date(dateStr) < new Date(selectedStartDate)) {
                    // If selected date is before start date, swap them
                    selectedEndDate = selectedStartDate;
                    selectedStartDate = dateStr;
                } else {
                    selectedEndDate = dateStr;
                }
                isSelectingRange = false;
            }

            renderCalendar();
            updateDatePickerButton();
        }

        function updateSelectedDatesDisplay() {
            const textElement = document.getElementById('selectedDatesText');
            const rangeElement = document.getElementById('selectedDatesRange');

            if (!selectedStartDate) {
                textElement.textContent = translations[currentLanguage].selectDatesPrompt;
                rangeElement.textContent = '';
            } else if (selectedStartDate && !selectedEndDate) {
                textElement.textContent = currentLanguage === 'en' 
                    ? 'Select end date' 
                    : 'Seleccione fecha de fin';
                rangeElement.textContent = formatDate(selectedStartDate);
            } else if (selectedStartDate && selectedEndDate) {
                const duration = Math.ceil((new Date(selectedEndDate) - new Date(selectedStartDate)) / (1000 * 60 * 60 * 24)) + 1;
                textElement.textContent = currentLanguage === 'en' 
                    ? `${duration} days trip` 
                    : `Viaje de ${duration} días`;
                rangeElement.textContent = `${formatDate(selectedStartDate)} → ${formatDate(selectedEndDate)}`;
            }
        }

        function changeMonth(direction) {
            currentCalendarMonth.setMonth(currentCalendarMonth.getMonth() + direction);
            renderCalendar();
        }

        function toggleLanguage() {
            currentLanguage = currentLanguage === 'en' ? 'es' : 'en';
            localStorage.setItem('language', currentLanguage);
            updateLanguage();
            updateGreeting(); // Update greeting when language changes
            
            // Re-render calendar with new language
            if (document.getElementById('calendarWeekdays')) {
                renderWeekdays();
                renderCalendar();
            }
            
            // Reload sidebar trips
            if (currentUser && document.getElementById('sidebarTripsList')) {
                loadSidebarTrips();
            }
            
            // Reload current view if in trip detail
            if (currentTrip) {
                renderTripDetail(currentTrip);
            } else if (document.getElementById('upcomingTrips')) {
                loadTrips();
            }
        }

        function updateLanguage() {
            const t = translations[currentLanguage];
            
            // Update all text elements
            const elements = [
                'authTitle', 'nameLabel', 'usernameLabel', 'passwordLabel', 'loginBtn', 'registerBtn',
                'createTripTitle', 'destinationLabel',
                'dateRangeLabel', 'createTripBtn', 'upcomingTripsTitle',
                'pastTripsTitle', 'backBtnText', 'startLabel', 'endLabel', 'durationLabel',
                'socketLabel', 'activitiesTitle', 'addActivityText', 'essentialsTitle',
                'toiletriesTitle', 'addItemText1', 'addItemText2', 'addItemText3',
                'addListBtnText',
                'outfitPlannerTitle', 'calendarDoneBtn', 'subheadingText', 'viewDetailsLink',
                'notesTitle', 'deleteTripText', 'apiBannerTitle',
                'upcomingTripsSidebarTitle', 'pastTripsSidebarTitle', 'newTripBtnText',
                'langBtnText', 'logoutBtnText'
            ];

            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element && t[id]) {
                    if (element.tagName === 'INPUT' || element.tagName === 'BUTTON') {
                        if (element.hasAttribute('placeholder')) {
                            element.placeholder = t[id];
                        } else {
                            element.textContent = t[id];
                        }
                    } else {
                        element.textContent = t[id];
                    }
                }
            });

            // Update API banner text (contains HTML link)
            const apiBannerText = document.getElementById('apiBannerText');
            if (apiBannerText) {
                const linkHtml = '<a href="https://www.weatherapi.com/signup.aspx" target="_blank" class="api-banner-link">WeatherAPI.com</a>';
                if (currentLanguage === 'en') {
                    apiBannerText.innerHTML = `Get a free API key from ${linkHtml} and add it to line 1731 of the code to see real weather forecasts for your trips!`;
                } else {
                    apiBannerText.innerHTML = `Obtenga una clave API gratuita de ${linkHtml} y agréguela en la línea 1731 del código para ver pronósticos meteorológicos reales para sus viajes!`;
                }
            }

            // Update placeholders
            const nameInput = document.getElementById('name');
            if (nameInput) {
                nameInput.placeholder = t.namePlaceholder;
            }
            
            const usernameInput = document.getElementById('username');
            if (usernameInput) {
                usernameInput.placeholder = t.usernamePlaceholder;
            }
            
            const passwordInput = document.getElementById('password');
            if (passwordInput) {
                passwordInput.placeholder = t.passwordPlaceholder;
            }
            
            const destInput = document.getElementById('destination');
            if (destInput) {
                destInput.placeholder = currentLanguage === 'en' ? 'Where are you going?' : '¿A dónde vas?';
            }

            // Update date picker button
            updateDatePickerButton();

            // Update calendar texts
            const selectedDatesText = document.getElementById('selectedDatesText');
            if (selectedDatesText && !selectedStartDate) {
                selectedDatesText.textContent = translations[currentLanguage].selectDatesPrompt;
            }
        }

        async function createTrip() {
            const destination = document.getElementById('destination').value.trim();
            const startDate = selectedStartDate;
            const endDate = selectedEndDate;

            if (!destination) {
                alert(currentLanguage === 'en' ? 'Please enter a destination' : 'Por favor ingrese un destino');
                return;
            }

            if (!startDate || !endDate) {
                alert(currentLanguage === 'en' ? 'Please select start and end dates' : 'Por favor seleccione fechas de inicio y fin');
                return;
            }

            // Trigger clothing animation
            triggerClothingAnimation();

            // Show loading message
            const createBtn = document.getElementById('createTripBtn');
            const originalBtnText = createBtn.textContent;
            createBtn.textContent = currentLanguage === 'en' ? 'Creating trip...' : 'Creando viaje...';
            createBtn.disabled = true;
            
            // Add wiggle animation to the button
            createBtn.classList.add('packing-animation');

            // Fetch real data from APIs
            const [countryData, weatherData] = await Promise.all([
                fetchCountryData(destination),
                fetchWeatherForecast(destination, startDate, endDate)
            ]);

            // Determine socket type using improved detection
            let socketType = getSocketType(destination);
            let voltage = getVoltage(socketType);
            
            // Try to use REST Countries API data if available (though it rarely has socket info)
            if (countryData) {
                if (countryData.plugTypes && countryData.plugTypes !== 'Check local' && countryData.plugTypes !== '') {
                    socketType = `Type ${countryData.plugTypes}`;
                }
                if (countryData.voltage && countryData.voltage !== 'Unknown' && countryData.voltage !== '') {
                    voltage = Array.isArray(countryData.voltage) 
                        ? `${countryData.voltage.join('/')}V` 
                        : `${countryData.voltage}V`;
                }
            }

            const users = JSON.parse(localStorage.getItem('users') || '{}');
            const trip = {
                id: Date.now(),
                name: destination,
                destination: destination,
                startDate: startDate,
                endDate: endDate,
                socketType: `${socketType} • ${voltage}`,
                socketIcon: getSocketSVG(socketType),
                emoji: getCountryFlagEmoji(destination),
                notes: '',
                activities: [],
                checklists: {
                    essentials: getDefaultEssentials(),
                    toiletries: getDefaultToiletries(),
                    custom: [],
                    customName: currentLanguage === 'en' ? 'Custom Items' : 'Artículos Personalizados'
                },
                outfits: {},
                weatherData: weatherData // Store weather data with trip
            };

            users[currentUser].trips.push(trip);
            localStorage.setItem('users', JSON.stringify(users));

            // Clear form
            document.getElementById('destination').value = '';
            selectedStartDate = null;
            selectedEndDate = null;
            renderCalendar();
            updateDatePickerButton();

            // Reset button
            createBtn.textContent = originalBtnText;
            createBtn.disabled = false;
            createBtn.classList.remove('packing-animation');

            // Open the trip
            openTrip(trip.id);
        }

        function getSocketType(destination) {
            const dest = destination.toLowerCase();
            
            // North America - Type A/B (110V)
            if (dest.includes('usa') || dest.includes('united states') || dest.includes('america') || 
                dest.includes('canada') || dest.includes('mexico') || dest.includes('bahamas') ||
                dest.includes('barbados') || dest.includes('jamaica') || dest.includes('costa rica') ||
                dest.includes('panama')) {
                return 'Type A/B';
            }
            
            // UK & Ireland - Type G (230V)
            if (dest.includes('uk') || dest.includes('united kingdom') || dest.includes('england') || 
                dest.includes('london') || dest.includes('scotland') || dest.includes('wales') ||
                dest.includes('ireland') || dest.includes('dublin') || dest.includes('belfast') ||
                dest.includes('manchester') || dest.includes('edinburgh')) {
                return 'Type G';
            }
            
            // Europe (Continental) - Type C/F (230V)
            if (dest.includes('spain') || dest.includes('france') || dest.includes('germany') || 
                dest.includes('italy') || dest.includes('portugal') || dest.includes('netherlands') || 
                dest.includes('belgium') || dest.includes('greece') || dest.includes('austria') || 
                dest.includes('switzerland') || dest.includes('poland') || dest.includes('czech') ||
                dest.includes('sweden') || dest.includes('norway') || dest.includes('denmark') || 
                dest.includes('finland') || dest.includes('hungary') || dest.includes('croatia') ||
                dest.includes('romania') || dest.includes('iceland') || dest.includes('luxembourg') ||
                dest.includes('monaco') || dest.includes('paris') || dest.includes('madrid') ||
                dest.includes('rome') || dest.includes('berlin') || dest.includes('amsterdam') ||
                dest.includes('barcelona') || dest.includes('lisbon') || dest.includes('vienna') ||
                dest.includes('prague') || dest.includes('budapest') || dest.includes('europe')) {
                return 'Type C/F';
            }
            
            // South America - Type C/I (220V)
            if (dest.includes('brazil') || dest.includes('argentina') || dest.includes('chile') || 
                dest.includes('peru') || dest.includes('colombia') || dest.includes('ecuador') || 
                dest.includes('bolivia') || dest.includes('uruguay') || dest.includes('venezuela') ||
                dest.includes('paraguay') || dest.includes('guyana') || dest.includes('suriname') ||
                dest.includes('buenos aires') || dest.includes('sao paulo') || dest.includes('rio') ||
                dest.includes('bogota') || dest.includes('lima') || dest.includes('santiago') ||
                dest.includes('quito') || dest.includes('montevideo') || dest.includes('caracas')) {
                return 'Type C/I';
            }
            
            // Australia & New Zealand - Type I (230V)
            if (dest.includes('australia') || dest.includes('sydney') || dest.includes('melbourne') || 
                dest.includes('brisbane') || dest.includes('perth') || dest.includes('adelaide') ||
                dest.includes('new zealand') || dest.includes('auckland') || dest.includes('wellington')) {
                return 'Type I';
            }
            
            // China - Type A/I (220V)
            if (dest.includes('china') || dest.includes('beijing') || dest.includes('shanghai') ||
                dest.includes('hong kong') || dest.includes('guangzhou') || dest.includes('shenzhen')) {
                return 'Type A/I';
            }
            
            // Japan - Type A/B (100V)
            if (dest.includes('japan') || dest.includes('tokyo') || dest.includes('osaka') ||
                dest.includes('kyoto') || dest.includes('hiroshima') || dest.includes('nagoya')) {
                return 'Type A/B';
            }
            
            // India - Type D/M (230V)
            if (dest.includes('india') || dest.includes('delhi') || dest.includes('mumbai') ||
                dest.includes('bangalore') || dest.includes('calcutta') || dest.includes('chennai') ||
                dest.includes('hyderabad') || dest.includes('pune')) {
                return 'Type D/M';
            }
            
            // Southeast Asia - Type A/C (220V)
            if (dest.includes('thailand') || dest.includes('bangkok') || dest.includes('vietnam') || 
                dest.includes('hanoi') || dest.includes('ho chi minh') || dest.includes('singapore') || 
                dest.includes('malaysia') || dest.includes('kuala lumpur') || dest.includes('indonesia') ||
                dest.includes('bali') || dest.includes('jakarta') || dest.includes('philippines') ||
                dest.includes('manila')) {
                return 'Type A/C';
            }
            
            // South Korea - Type C/F (220V)
            if (dest.includes('korea') || dest.includes('seoul') || dest.includes('busan')) {
                return 'Type C/F';
            }
            
            // Middle East - Type C/D/G (220V)
            if (dest.includes('dubai') || dest.includes('uae') || dest.includes('emirates') ||
                dest.includes('qatar') || dest.includes('doha') || dest.includes('saudi') ||
                dest.includes('riyadh') || dest.includes('jeddah') || dest.includes('kuwait') ||
                dest.includes('bahrain') || dest.includes('oman')) {
                return 'Type C/G';
            }
            
            // Turkey - Type C/F (230V)
            if (dest.includes('turkey') || dest.includes('istanbul') || dest.includes('ankara')) {
                return 'Type C/F';
            }
            
            // South Africa - Type M (230V)
            if (dest.includes('south africa') || dest.includes('cape town') || 
                dest.includes('johannesburg') || dest.includes('durban')) {
                return 'Type M';
            }
            
            // Israel - Type C/H (230V)
            if (dest.includes('israel') || dest.includes('tel aviv') || dest.includes('jerusalem')) {
                return 'Type C/H';
            }
            
            // Default to most common European standard
            return 'Type C/F';
        }

        function getDefaultEssentials() {
            return [
                { text: 'Passport', checked: false },
                { text: 'Phone charger', checked: false },
                { text: 'Laptop charger', checked: false },
                { text: 'Travel adapter', checked: false },
                { text: 'Sunglasses', checked: false },
                { text: 'Wallet', checked: false },
                { text: 'Keys', checked: false },
                { text: 'Headphones', checked: false }
            ];
        }

        function getDefaultToiletries() {
            return [
                { text: 'Toothbrush', checked: false },
                { text: 'Toothpaste', checked: false },
                { text: 'Shampoo', checked: false },
                { text: 'Soap', checked: false },
                { text: 'Deodorant', checked: false },
                { text: 'Sunscreen', checked: false },
                { text: 'Medicine', checked: false },
                { text: 'First aid kit', checked: false }
            ];
        }

        function updateGreeting() {
            const hour = new Date().getHours();
            const greetingElement = document.getElementById('greetingText');
            
            if (!greetingElement) return;
            
            let greeting;
            if (currentLanguage === 'en') {
                if (hour >= 5 && hour < 12) {
                    greeting = 'Good Morning';
                } else if (hour >= 12 && hour < 18) {
                    greeting = 'Good Afternoon';
                } else {
                    greeting = 'Good Evening';
                }
            } else {
                if (hour >= 5 && hour < 12) {
                    greeting = 'Buenos Días';
                } else if (hour >= 12 && hour < 18) {
                    greeting = 'Buenas Tardes';
                } else {
                    greeting = 'Buenas Noches';
                }
            }
            
            greetingElement.textContent = greeting;
        }

        function loadTrips() {
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            const trips = users[currentUser]?.trips || [];

            const today = new Date();
            today.setHours(0, 0, 0, 0);

            // Update greeting based on time of day
            updateGreeting();

            // Upcoming trips: trips that haven't ended yet (endDate >= today)
            const upcoming = trips.filter(t => new Date(t.endDate) >= today)
                .sort((a, b) => new Date(a.startDate) - new Date(b.startDate));
            
            // Past trips: trips where the end date has passed (endDate < today)
            const past = trips.filter(t => new Date(t.endDate) < today)
                .sort((a, b) => new Date(b.endDate) - new Date(a.endDate));

            renderUpcomingTrips(upcoming);
            renderPastTrips(past);
        }

        function renderUpcomingTrips(trips) {
            const container = document.getElementById('upcomingTrips');
            container.innerHTML = '';

            trips.forEach(trip => {
                const duration = Math.ceil((new Date(trip.endDate) - new Date(trip.startDate)) / (1000 * 60 * 60 * 24)) + 1;
                const startDate = new Date(trip.startDate);
                const endDate = new Date(trip.endDate);
                
                // Format dates
                const startFormatted = startDate.toLocaleDateString(currentLanguage === 'en' ? 'en-US' : 'es-ES', { month: 'short', day: 'numeric' });
                const endFormatted = endDate.toLocaleDateString(currentLanguage === 'en' ? 'en-US' : 'es-ES', { month: 'short', day: 'numeric' });
                
                // Updated date
                const updatedDate = new Date(trip.id).toLocaleDateString(currentLanguage === 'en' ? 'en-US' : 'es-ES', { month: 'numeric', day: 'numeric', year: 'numeric' });
                
                // Get emoji for icon (use saved emoji or generate from destination)
                const tripEmoji = trip.emoji || getCountryFlagEmoji(trip.destination);
                
                const card = document.createElement('div');
                card.className = 'trip-card';
                card.onclick = () => openTrip(trip.id);
                card.innerHTML = `
                    <div class="trip-card-header">
                        <div class="trip-card-icon">${tripEmoji}</div>
                        <div class="trip-card-main">
                            <h3>${trip.name}</h3>
                            <p class="trip-card-subtitle">${trip.destination}</p>
                            <p class="trip-card-dates">${startFormatted} - ${endFormatted} · ${duration} ${translations[currentLanguage].days} · ${currentLanguage === 'en' ? 'Updated' : 'Actualizado'} ${updatedDate}</p>
                            <p class="trip-card-socket">${trip.socketIcon || getSocketSVG(trip.socketType)}${trip.socketType}</p>
                        </div>
                        <div class="trip-duration-badge-card">${duration} ${translations[currentLanguage].days}</div>
                    </div>
                `;
                container.appendChild(card);
            });

            if (trips.length === 0) {
                container.innerHTML = `<p style="color: #999; text-align: center; width: 100%;">${currentLanguage === 'en' ? 'No upcoming trips' : 'No hay viajes próximos'}</p>`;
            }
        }

        function renderPastTrips(trips) {
            const container = document.getElementById('pastTrips');
            container.innerHTML = '';

            trips.forEach(trip => {
                const duration = Math.ceil((new Date(trip.endDate) - new Date(trip.startDate)) / (1000 * 60 * 60 * 24)) + 1;
                const startDate = new Date(trip.startDate);
                const endDate = new Date(trip.endDate);
                
                // Format dates
                const startFormatted = startDate.toLocaleDateString(currentLanguage === 'en' ? 'en-US' : 'es-ES', { month: 'short', day: 'numeric' });
                const endFormatted = endDate.toLocaleDateString(currentLanguage === 'en' ? 'en-US' : 'es-ES', { month: 'short', day: 'numeric' });
                
                // Get emoji for icon (use saved emoji or generate from destination)
                const tripEmoji = trip.emoji || getCountryFlagEmoji(trip.destination);
                
                const card = document.createElement('div');
                card.className = 'trip-card';
                card.onclick = () => openTrip(trip.id);
                card.innerHTML = `
                    <div class="trip-card-header">
                        <div class="trip-card-icon">${tripEmoji}</div>
                        <div class="trip-card-main">
                            <h3>${trip.name}</h3>
                            <p class="trip-card-subtitle">${trip.destination} · ${startFormatted} - ${endFormatted}</p>
                        </div>
                        <div class="trip-duration-badge-card">${duration} ${translations[currentLanguage].days}</div>
                    </div>
                `;
                container.appendChild(card);
            });

            if (trips.length === 0) {
                container.innerHTML = `<p style="color: #999; text-align: center; width: 100%;">${currentLanguage === 'en' ? 'No past trips' : 'No hay viajes pasados'}</p>`;
            }
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString(currentLanguage === 'en' ? 'en-US' : 'es-ES', { 
                month: 'short', 
                day: 'numeric', 
                year: 'numeric' 
            });
        }

        function openTrip(tripId) {
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            const trip = users[currentUser].trips.find(t => t.id === tripId);
            
            if (trip) {
                currentTrip = trip;
                renderTripDetail(trip);
                document.getElementById('landingPage').classList.add('hidden');
                document.getElementById('tripDetailPage').classList.remove('hidden');
            }
        }

        function showLandingPage() {
            currentTrip = null;
            document.getElementById('tripDetailPage').classList.add('hidden');
            document.getElementById('landingPage').classList.remove('hidden');
            selectedStartDate = null;
            selectedEndDate = null;
            renderCalendar();
            updateDatePickerButton();
            loadTrips();
        }

        function renderTripDetail(trip) {
            const duration = Math.ceil((new Date(trip.endDate) - new Date(trip.startDate)) / (1000 * 60 * 60 * 24)) + 1;

            // Set trip icon (emoji)
            const tripEmoji = trip.emoji || getCountryFlagEmoji(trip.destination);
            const tripIconEl = document.getElementById('tripIcon');
            tripIconEl.textContent = tripEmoji;
            tripIconEl.style.cursor = 'pointer';
            tripIconEl.title = currentLanguage === 'en' ? 'Click to change emoji' : 'Clic para cambiar emoji';
            tripIconEl.onclick = () => changeEmoji();

            // Set trip name
            document.getElementById('tripName').value = trip.name;

            // Set duration badge
            document.getElementById('tripDurationBadge').textContent = `${duration} ${duration === 1 ? (currentLanguage === 'en' ? 'day' : 'día') : translations[currentLanguage].days}`;

            // Set socket info
            document.getElementById('tripSocketInline').innerHTML = `${trip.socketIcon || getSocketSVG(trip.socketType)}${trip.socketType}`;

            // Set subtitle with location, dates, and duration
            const startDate = formatDate(trip.startDate);
            const endDate = formatDate(trip.endDate);
            const monthStart = new Date(trip.startDate).toLocaleDateString(currentLanguage === 'en' ? 'en-US' : 'es-ES', { month: 'short', day: 'numeric' });
            const monthEnd = new Date(trip.endDate).toLocaleDateString(currentLanguage === 'en' ? 'en-US' : 'es-ES', { month: 'short', day: 'numeric' });
            document.getElementById('tripSubtitleInline').textContent = `${trip.destination} • ${monthStart} – ${monthEnd} • ${duration} ${translations[currentLanguage].days}`;

            // Set notes
            document.getElementById('tripNotes').value = trip.notes || '';

            renderActivities(trip);
            renderChecklists(trip);
            renderOutfitPlanner(trip);
        }

        function renderActivities(trip) {
            // Ensure all activities have IDs (migration for old data)
            trip.activities.forEach(activity => {
                if (!activity.id) {
                    activity.id = Date.now() + Math.random();
                }
            });
            
            const container = document.getElementById('activitiesList');
            const noActivitiesMsg = document.getElementById('noActivitiesText');
            
            if (trip.activities.length === 0) {
                container.innerHTML = `<p class="no-activities" id="noActivitiesText">${currentLanguage === 'en' ? 'No activities yet.' : 'No hay actividades aún.'}</p>`;
                return;
            }

            container.innerHTML = '';

            trip.activities.forEach((activity, index) => {
                const div = document.createElement('div');
                
                // Ensure activity has all required fields
                if (!activity.date) activity.date = trip.startDate;
                if (!activity.type) activity.type = 'day';
                if (!activity.emoji) activity.emoji = '🎯';
                if (!activity.name) activity.name = '';
                if (activity.isEditing === undefined) activity.isEditing = false;
                
                // Format date for display
                const dateDisplay = activity.date ? new Date(activity.date).toLocaleDateString(currentLanguage === 'en' ? 'en-US' : 'es-ES', { 
                    month: 'short', 
                    day: 'numeric', 
                    year: 'numeric' 
                }) : '';
                
                const typeIcon = activity.type === 'day' ? '☀️' : '🌙';
                const typeText = activity.type === 'day' ? translations[currentLanguage].dayActivity : translations[currentLanguage].nightActivity;
                
                if (activity.isEditing) {
                    // Edit Mode
                    div.className = 'activity-item';
                    div.innerHTML = `
                        <div class="activity-emoji" onclick="openActivityEmojiPicker(${index})">${activity.emoji}</div>
                        <input type="text" 
                               id="activityDate${index}"
                               value="${dateDisplay}" 
                               readonly
                               onclick="openActivityDatePicker(${index})"
                               placeholder="${currentLanguage === 'en' ? 'Select date' : 'Seleccionar fecha'}"
                               style="cursor: pointer;">
                        <input type="text" value="${activity.name}" placeholder="${currentLanguage === 'en' ? 'Activity name' : 'Nombre de actividad'}" oninput="updateActivity(${index}, 'name', this.value)">
                        <div class="activity-type-toggle">
                            <div class="activity-type-option ${activity.type === 'day' ? 'active' : ''}" onclick="updateActivity(${index}, 'type', 'day')">
                                ☀️ ${translations[currentLanguage].dayActivity}
                            </div>
                            <div class="activity-type-option ${activity.type === 'night' ? 'active' : ''}" onclick="updateActivity(${index}, 'type', 'night')">
                                🌙 ${translations[currentLanguage].nightActivity}
                            </div>
                        </div>
                        <div class="activity-actions">
                            <button class="save-btn" onclick="saveActivity(${index})" ${!activity.name ? 'disabled' : ''}>
                                ${currentLanguage === 'en' ? '✓ Save' : '✓ Guardar'}
                            </button>
                            <button class="delete-btn" onclick="deleteActivity(${index})">✕</button>
                        </div>
                    `;
                } else {
                    // Saved/View Mode
                    div.className = 'activity-item saved';
                    div.innerHTML = `
                        <div class="activity-saved-content">
                            <div class="activity-saved-emoji">${activity.emoji}</div>
                            <div class="activity-saved-details">
                                <div class="activity-saved-name">${activity.name}</div>
                                <div class="activity-saved-meta">
                                    <div class="activity-saved-date">
                                        📅 ${dateDisplay}
                                    </div>
                                    <div class="activity-saved-type">
                                        ${typeIcon} ${typeText}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="activity-actions">
                            <button class="edit-btn" onclick="editActivity(${index})">
                                ${currentLanguage === 'en' ? '✎ Edit' : '✎ Editar'}
                            </button>
                            <button class="delete-btn" onclick="deleteActivity(${index})">✕</button>
                        </div>
                    `;
                }
                
                container.appendChild(div);
            });
        }

        function addActivity() {
            if (!currentTrip) return;

            currentTrip.activities.push({
                id: Date.now(),
                name: '',
                date: currentTrip.startDate,
                type: 'day',
                emoji: '🎯',
                isEditing: true
            });

            saveCurrentTrip();
            renderActivities(currentTrip);
            renderOutfitPlanner(currentTrip);
        }

        function updateActivity(index, field, value) {
            if (!currentTrip) return;
            
            // Validate and format date properly
            if (field === 'date' && value) {
                // Ensure date is in YYYY-MM-DD format
                const date = new Date(value);
                if (!isNaN(date.getTime())) {
                    currentTrip.activities[index][field] = value;
                } else {
                    console.error('Invalid date:', value);
                    return;
                }
            } else {
                currentTrip.activities[index][field] = value;
            }
            
            saveCurrentTrip();
            
            // Re-render activities if type changed to update toggle visual state
            // or if name changed to update save button state
            if (field === 'type' || field === 'name') {
                renderActivities(currentTrip);
            }
            
            if (field === 'date' || field === 'type' || field === 'name') {
                renderOutfitPlanner(currentTrip);
            }
        }

        function saveActivity(index) {
            if (!currentTrip) return;
            const activity = currentTrip.activities[index];
            
            // Validate that activity has a name
            if (!activity.name || activity.name.trim() === '') {
                alert(currentLanguage === 'en' ? 'Please enter an activity name' : 'Por favor ingrese un nombre de actividad');
                return;
            }
            
            // Set editing to false to save the activity
            activity.isEditing = false;
            saveCurrentTrip();
            renderActivities(currentTrip);
            renderOutfitPlanner(currentTrip); // Update outfit planner to show the saved activity
        }

        function editActivity(index) {
            if (!currentTrip) return;
            
            // Set editing to true to edit the activity
            currentTrip.activities[index].isEditing = true;
            saveCurrentTrip();
            renderActivities(currentTrip);
            renderOutfitPlanner(currentTrip); // Update outfit planner to hide the activity being edited
        }

        function deleteActivity(index) {
            if (!currentTrip) return;
            
            const confirmMsg = currentLanguage === 'en' 
                ? 'Are you sure you want to delete this activity?' 
                : '¿Estás seguro de que quieres eliminar esta actividad?';
            
            if (!confirm(confirmMsg)) return;
            
            currentTrip.activities.splice(index, 1);
            saveCurrentTrip();
            renderActivities(currentTrip);
            renderOutfitPlanner(currentTrip);
        }

        // Activity Emoji Picker Functions
        function openActivityEmojiPicker(activityIndex) {
            selectedActivityIndex = activityIndex;
            emojiPickerContext = 'activity'; // Set context to activity
            
            // Initialize the modern emoji picker with all emojis
            filterEmojiCategory('all');
            
            // Show the modern emoji picker modal
            document.getElementById('emojiPickerModal').classList.remove('hidden');
        }

        function selectActivityEmoji(emoji) {
            if (selectedActivityIndex !== null && currentTrip) {
                currentTrip.activities[selectedActivityIndex].emoji = emoji;
                saveCurrentTrip();
                renderActivities(currentTrip);
                renderOutfitPlanner(currentTrip);
            }
            closeEmojiPicker();
        }

        function closeEmojiPicker() {
            document.getElementById('emojiPickerModal').classList.add('hidden');
            document.getElementById('emojiPicker').classList.add('hidden');
            document.getElementById('overlay').classList.add('hidden');
            selectedActivityIndex = null;
            emojiPickerContext = null;
        }

        function closeOverlay() {
            // Close whichever modal is open
            if (!document.getElementById('dateRangePicker').classList.contains('hidden')) {
                closeCalendar();
            }
            if (!document.getElementById('emojiPicker').classList.contains('hidden')) {
                closeEmojiPicker();
            }
            if (!document.getElementById('activityDatePicker').classList.contains('hidden')) {
                closeActivityDatePicker();
            }
        }

        // Activity Date Picker Functions
        function openActivityDatePicker(activityIndex) {
            if (!currentTrip) return;
            
            selectedActivityIndexForDate = activityIndex;
            const activity = currentTrip.activities[activityIndex];
            selectedActivityDateValue = activity.date;
            
            // Initialize the month to show the activity's current date or trip start date
            if (activity.date) {
                activityDatePickerMonth = new Date(activity.date);
            } else {
                activityDatePickerMonth = new Date(currentTrip.startDate);
            }
            
            // Update title based on language
            document.getElementById('activityDatePickerTitle').textContent = 
                currentLanguage === 'en' ? 'Select Date' : 'Seleccionar Fecha';
            
            // Render the calendar
            renderActivityCalendar();
            
            // Show the modal and overlay
            document.getElementById('activityDatePicker').classList.remove('hidden');
            document.getElementById('overlay').classList.remove('hidden');
        }

        function closeActivityDatePicker() {
            document.getElementById('activityDatePicker').classList.add('hidden');
            document.getElementById('overlay').classList.add('hidden');
            selectedActivityIndexForDate = null;
            selectedActivityDateValue = null;
        }

        function changeActivityMonth(direction) {
            activityDatePickerMonth.setMonth(activityDatePickerMonth.getMonth() + direction);
            renderActivityCalendar();
        }

        function renderActivityCalendar() {
            const year = activityDatePickerMonth.getFullYear();
            const month = activityDatePickerMonth.getMonth();
            
            // Update month/year display
            const monthNames = currentLanguage === 'en' 
                ? ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December']
                : ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
            document.getElementById('activityMonthYear').textContent = `${monthNames[month]} ${year}`;
            
            // Get first day of month and number of days
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const daysInPrevMonth = new Date(year, month, 0).getDate();
            
            // Build calendar
            const calendarDays = document.getElementById('activityCalendarDays');
            calendarDays.innerHTML = '';
            
            // Get trip date range for validation
            const tripStart = new Date(currentTrip.startDate);
            const tripEnd = new Date(currentTrip.endDate);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // Previous month's trailing days
            for (let i = firstDay - 1; i >= 0; i--) {
                const day = daysInPrevMonth - i;
                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day other-month';
                dayDiv.textContent = day;
                calendarDays.appendChild(dayDiv);
            }
            
            // Current month's days
            for (let day = 1; day <= daysInMonth; day++) {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day';
                dayDiv.textContent = day;
                
                const currentDate = new Date(year, month, day);
                const dateStr = currentDate.toISOString().split('T')[0];
                
                // Check if it's today
                if (currentDate.getTime() === today.getTime()) {
                    dayDiv.classList.add('today');
                }
                
                // Check if it's the selected date
                if (dateStr === selectedActivityDateValue) {
                    dayDiv.classList.add('selected');
                }
                
                // Check if date is within trip range
                if (currentDate >= tripStart && currentDate <= tripEnd) {
                    dayDiv.style.cursor = 'pointer';
                    dayDiv.onclick = () => selectActivityDate(dateStr);
                } else {
                    dayDiv.classList.add('other-month');
                    dayDiv.style.cursor = 'not-allowed';
                }
                
                calendarDays.appendChild(dayDiv);
            }
            
            // Next month's leading days
            const totalCells = calendarDays.children.length;
            const remainingCells = 42 - totalCells; // 6 rows of 7 days
            for (let day = 1; day <= remainingCells; day++) {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day other-month';
                dayDiv.textContent = day;
                calendarDays.appendChild(dayDiv);
            }
        }

        function selectActivityDate(dateStr) {
            if (selectedActivityIndexForDate !== null && currentTrip) {
                updateActivity(selectedActivityIndexForDate, 'date', dateStr);
                closeActivityDatePicker();
            }
        }

        function renderChecklists(trip) {
            renderChecklistItems('essentials', trip.checklists.essentials);
            renderChecklistItems('toiletries', trip.checklists.toiletries);
            renderChecklistItems('custom', trip.checklists.custom);
            document.getElementById('customListName').value = trip.checklists.customName || '';
            
            // Restore custom list visibility
            const customColumn = document.getElementById('customListColumn');
            const addListBtn = document.getElementById('addCustomListBtn');
            
            if (trip.showCustomList) {
                customColumn.style.display = 'block';
                addListBtn.style.display = 'none';
            } else {
                customColumn.style.display = 'none';
                addListBtn.style.display = 'inline-flex';
            }
        }

        function renderChecklistItems(listType, items) {
            const container = document.getElementById(`${listType}List`);
            container.innerHTML = '';

            items.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = `checklist-item ${item.checked ? 'checked' : ''}`;
                div.innerHTML = `
                    <input type="checkbox" ${item.checked ? 'checked' : ''} onchange="toggleChecklistItem('${listType}', ${index})">
                    <input type="text" value="${item.text}" oninput="updateChecklistItem('${listType}', ${index}, this.value)">
                    <button class="delete-btn" onclick="deleteChecklistItem('${listType}', ${index})">✕</button>
                `;
                container.appendChild(div);
            });
        }

        function addChecklistItem(listType) {
            if (!currentTrip) return;
            currentTrip.checklists[listType].push({ text: '', checked: false });
            saveCurrentTrip();
            renderChecklistItems(listType, currentTrip.checklists[listType]);
        }

        function updateChecklistItem(listType, index, value) {
            if (!currentTrip) return;
            currentTrip.checklists[listType][index].text = value;
            saveCurrentTrip();
        }

        function toggleChecklistItem(listType, index) {
            if (!currentTrip) return;
            currentTrip.checklists[listType][index].checked = !currentTrip.checklists[listType][index].checked;
            saveCurrentTrip();
            renderChecklistItems(listType, currentTrip.checklists[listType]);
        }

        function toggleCustomList() {
            const customColumn = document.getElementById('customListColumn');
            const addListBtn = document.getElementById('addCustomListBtn');
            
            if (customColumn.style.display === 'none') {
                // Show custom list
                customColumn.style.display = 'block';
                addListBtn.style.display = 'none';
                
                // Save state
                if (currentTrip) {
                    currentTrip.showCustomList = true;
                    saveCurrentTrip();
                }
            } else {
                // Hide custom list
                customColumn.style.display = 'none';
                addListBtn.style.display = 'inline-flex';
                
                // Save state
                if (currentTrip) {
                    currentTrip.showCustomList = false;
                    saveCurrentTrip();
                }
            }
        }

        function deleteChecklistItem(listType, index) {
            if (!currentTrip) return;
            currentTrip.checklists[listType].splice(index, 1);
            saveCurrentTrip();
            renderChecklistItems(listType, currentTrip.checklists[listType]);
        }

        function renderOutfitPlanner(trip) {
            const container = document.getElementById('outfitPlannerContent');
            container.innerHTML = '';

            const startDate = new Date(trip.startDate);
            const endDate = new Date(trip.endDate);
            const days = [];

            for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
                days.push(new Date(d));
            }

            // Group by weeks
            const weeks = [];
            let currentWeek = [];
            
            days.forEach((day, index) => {
                currentWeek.push(day);
                if (currentWeek.length === 7 || index === days.length - 1) {
                    weeks.push([...currentWeek]);
                    currentWeek = [];
                }
            });

            weeks.forEach((week, weekIndex) => {
                const weekDiv = document.createElement('div');
                weekDiv.className = 'week-row';
                weekDiv.innerHTML = `<div class="week-label">${translations[currentLanguage].week} ${weekIndex + 1}</div>`;
                
                const daysGrid = document.createElement('div');
                daysGrid.className = 'days-grid';

                week.forEach((day, dayIndex) => {
                    const dateStr = day.toISOString().split('T')[0];
                    const dayOfWeek = day.toLocaleDateString(currentLanguage === 'en' ? 'en-US' : 'es-ES', { weekday: 'short' });
                    const dayNum = day.getDate();

                    // Get real weather data or use default
                    const weatherDisplay = trip.weatherData 
                        ? formatWeatherData(trip.weatherData, dateStr)
                        : '☀️ 72°F';

                    if (!trip.outfits[dateStr]) {
                        trip.outfits[dateStr] = {
                            day: { top: '', bottom: '', jacket: '', accessory: '', shoes: '' },
                            night: { top: '', bottom: '', jacket: '', accessory: '', shoes: '' },
                            weather: weatherDisplay
                        };
                    } else {
                        // Update weather if we have new data
                        trip.outfits[dateStr].weather = weatherDisplay;
                    }

                    const outfit = trip.outfits[dateStr];
                    // Only show saved activities (not in edit mode)
                    const dayActivities = trip.activities.filter(a => a.date === dateStr && !a.isEditing);
                    const dayAct = dayActivities.find(a => a.type === 'day');
                    const nightAct = dayActivities.find(a => a.type === 'night');

                    const dayCard = document.createElement('div');
                    dayCard.className = 'day-card';
                    
                    // Build activities HTML
                    const activitiesHtml = renderDayActivities(dateStr, dayActivities);
                    
                    dayCard.innerHTML = `
                        <div class="day-header">${dayOfWeek} ${dayNum}</div>
                        <div class="day-date">${formatDate(dateStr)}</div>
                        <div class="weather-info">${outfit.weather}</div>
                        
                        <div class="day-activities-section">
                            <div class="day-activities-header">
                                <h5>${currentLanguage === 'en' ? 'Activities' : 'Actividades'}</h5>
                                <button class="add-day-activity-btn" onclick="addActivityFromPlanner('${dateStr}')" title="${currentLanguage === 'en' ? 'Add Activity' : 'Agregar Actividad'}">+</button>
                            </div>
                            <div class="day-activities-list" id="activities-${dateStr}">
                                ${activitiesHtml}
                            </div>
                        </div>
                        
                        <div class="outfit-section">
                            <h5>${translations[currentLanguage].dayOutfit}</h5>
                            <div class="outfit-items">
                                ${renderOutfitInputs(dateStr, 'day', outfit.day)}
                            </div>
                        </div>

                        <div class="outfit-section">
                            <h5>${translations[currentLanguage].nightOutfit}</h5>
                            <div class="outfit-items">
                                ${renderOutfitInputs(dateStr, 'night', outfit.night)}
                            </div>
                        </div>
                    `;

                    daysGrid.appendChild(dayCard);
                });

                weekDiv.appendChild(daysGrid);
                container.appendChild(weekDiv);
            });

            saveCurrentTrip();
        }

        function renderDayActivities(dateStr, activities) {
            if (activities.length === 0) {
                return `<p class="no-day-activities">${currentLanguage === 'en' ? 'No activities planned' : 'Sin actividades'}</p>`;
            }
            
            return activities.map(activity => `
                <div class="day-activity-item" data-activity-id="${activity.id}">
                    <span class="day-activity-icon">${activity.type === 'day' ? '☀️' : '🌙'} ${activity.emoji}</span>
                    <span class="day-activity-name">${activity.name}</span>
                    <button class="remove-day-activity-btn" onclick="deleteActivityFromPlanner(${activity.id})" title="${currentLanguage === 'en' ? 'Remove' : 'Eliminar'}">×</button>
                </div>
            `).join('');
        }

        function addActivityFromPlanner(dateStr) {
            if (!currentTrip) return;
            
            // Create a new activity with the selected date
            currentTrip.activities.push({
                id: Date.now(),
                name: '',
                date: dateStr,
                type: 'day',
                emoji: '🎯',
                isEditing: true
            });

            saveCurrentTrip();
            renderActivities(currentTrip);
            renderOutfitPlanner(currentTrip);
            
            // Scroll to the activities section so user can see the new activity
            document.getElementById('activitiesList').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function deleteActivityFromPlanner(activityId) {
            if (!currentTrip) return;
            
            currentTrip.activities = currentTrip.activities.filter(a => a.id !== activityId);
            saveCurrentTrip();
            renderActivities(currentTrip);
            renderOutfitPlanner(currentTrip);
        }

        function renderOutfitInputs(date, timeOfDay, outfit) {
            const items = ['top', 'bottom', 'jacket', 'accessory', 'shoes'];
            return items.map(item => {
                const isPacked = outfit[`${item}_packed`] || false;
                return `
                    <div class="outfit-item">
                        <input type="checkbox" 
                               id="outfit_${date}_${timeOfDay}_${item}" 
                               class="outfit-checkbox"
                               ${isPacked ? 'checked' : ''}
                               onchange="toggleOutfitPacked('${date}', '${timeOfDay}', '${item}', this.checked)">
                        <label for="outfit_${date}_${timeOfDay}_${item}" class="outfit-item-content ${isPacked ? 'packed' : ''}">
                            <span class="outfit-label">${translations[currentLanguage][item] || item}:</span>
                            <input type="text" value="${outfit[item] || ''}" 
                                   placeholder="${translations[currentLanguage][item] || item}"
                                   oninput="updateOutfit('${date}', '${timeOfDay}', '${item}', this.value)"
                                   class="outfit-input">
                        </label>
                    </div>
                `;
            }).join('');
        }

        function updateOutfit(date, timeOfDay, item, value) {
            if (!currentTrip) return;
            if (!currentTrip.outfits[date]) {
                currentTrip.outfits[date] = {
                    day: { top: '', bottom: '', jacket: '', accessory: '', shoes: '' },
                    night: { top: '', bottom: '', jacket: '', accessory: '', shoes: '' },
                    weather: '☀️ 72°F'
                };
            }
            currentTrip.outfits[date][timeOfDay][item] = value;
            saveCurrentTrip();
        }

        function toggleOutfitPacked(date, timeOfDay, item, isPacked) {
            if (!currentTrip) return;
            if (!currentTrip.outfits[date]) {
                currentTrip.outfits[date] = {
                    day: { top: '', bottom: '', jacket: '', accessory: '', shoes: '' },
                    night: { top: '', bottom: '', jacket: '', accessory: '', shoes: '' },
                    weather: '☀️ 72°F'
                };
            }
            currentTrip.outfits[date][timeOfDay][`${item}_packed`] = isPacked;
            saveCurrentTrip();
            
            // Re-render to show visual update
            renderOutfitPlanner(currentTrip);
        }

        // Emoji data organized by category
        const emojiData = {
            smileys: ['😀', '😃', '😄', '😁', '😆', '😅', '🤣', '😂', '🙂', '🙃', '😉', '😊', '😇', '🥰', '😍', '🤩', '😘', '😗', '😚', '😙', '🥲', '😋', '😛', '😜', '🤪', '😝', '🤑', '🤗', '🤭', '🤫', '🤔', '🤐', '🤨', '😐', '😑', '😶', '😏', '😒', '🙄', '😬', '🤥', '😌', '😔', '😪', '🤤', '😴', '😷', '🤒', '🤕', '🤢', '🤮', '🤧', '🥵', '🥶', '🥴', '😵', '🤯', '🤠', '🥳', '🥸', '😎', '🤓', '🧐'],
            animals: ['🐶', '🐱', '🐭', '🐹', '🐰', '🦊', '🐻', '🐼', '🐨', '🐯', '🦁', '🐮', '🐷', '🐸', '🐵', '🐔', '🐧', '🐦', '🐤', '🐣', '🐥', '🦆', '🦅', '🦉', '🦇', '🐺', '🐗', '🐴', '🦄', '🐝', '🐛', '🦋', '🐌', '🐞', '🐜', '🦟', '🦗', '🕷', '🦂', '🐢', '🐍', '🦎', '🦖', '🦕', '🐙', '🦑', '🦐', '🦞', '🦀', '🐡', '🐠', '🐟', '🐬', '🐳', '🐋', '🦈', '🐊', '🐅', '🐆', '🦓', '🦍', '🦧', '🐘', '🦛', '🦏', '🐪', '🐫', '🦒', '🦘', '🐃', '🐂', '🐄', '🐎', '🐖', '🐏', '🐑', '🦙', '🐐', '🦌', '🐕', '🐩', '🦮', '🐈', '🐓', '🦃', '🦚', '🦜', '🦢', '🦩', '🕊', '🐇', '🦝', '🦨', '🦡', '🦦', '🦥', '🐁', '🐀', '🐿', '🦔'],
            food: ['🍏', '🍎', '🍐', '🍊', '🍋', '🍌', '🍉', '🍇', '🍓', '🫐', '🍈', '🍒', '🍑', '🥭', '🍍', '🥥', '🥝', '🍅', '🍆', '🥑', '🥦', '🥬', '🥒', '🌶', '🫑', '🌽', '🥕', '🫒', '🧄', '🧅', '🥔', '🍠', '🥐', '🥯', '🍞', '🥖', '🥨', '🧀', '🥚', '🍳', '🧈', '🥞', '🧇', '🥓', '🥩', '🍗', '🍖', '🦴', '🌭', '🍔', '🍟', '🍕', '🫓', '🥪', '🥙', '🧆', '🌮', '🌯', '🫔', '🥗', '🥘', '🫕', '🥫', '🍝', '🍜', '🍲', '🍛', '🍣', '🍱', '🥟', '🦪', '🍤', '🍙', '🍚', '🍘', '🍥', '🥠', '🥮', '🍢', '🍡', '🍧', '🍨', '🍦', '🥧', '🧁', '🍰', '🎂', '🍮', '🍭', '🍬', '🍫', '🍿', '🍩', '🍪', '🌰', '🥜', '🍯'],
            activities: ['⚽', '🏀', '🏈', '⚾', '🥎', '🎾', '🏐', '🏉', '🥏', '🎱', '🪀', '🏓', '🏸', '🏒', '🏑', '🥍', '🏏', '🪃', '🥅', '⛳', '🪁', '🏹', '🎣', '🤿', '🥊', '🥋', '🎽', '🛹', '🛼', '🛷', '⛸', '🥌', '🎿', '⛷', '🏂', '🪂', '🏋', '🤼', '🤸', '🤺', '🤾', '🏌', '🏇', '🧘', '🏊', '🤽', '🚣', '🧗', '🚵', '🚴', '🏆', '🥇', '🥈', '🥉', '🏅', '🎖', '🎗', '🎫', '🎟', '🎪', '🤹', '🎭', '🩰', '🎨', '🎬', '🎤', '🎧', '🎼', '🎹', '🥁', '🪘', '🎷', '🎺', '🪗', '🎸', '🪕', '🎻', '🎲', '♟', '🎯', '🎳', '🎮', '🎰', '🧩'],
            travel: ['🚗', '🚕', '🚙', '🚌', '🚎', '🏎', '🚓', '🚑', '🚒', '🚐', '🛻', '🚚', '🚛', '🚜', '🦯', '🦽', '🦼', '🛴', '🚲', '🛵', '🏍', '🛺', '🚨', '🚔', '🚍', '🚘', '🚖', '🚡', '🚠', '🚟', '🚃', '🚋', '🚞', '🚝', '🚄', '🚅', '🚈', '🚂', '🚆', '🚇', '🚊', '🚉', '✈', '🛫', '🛬', '🛩', '💺', '🛰', '🚀', '🛸', '🚁', '🛶', '⛵', '🚤', '🛥', '🛳', '⛴', '🚢', '⚓', '⛽', '🚧', '🚦', '🚥', '🗺', '🗿', '🗽', '🗼', '🏰', '🏯', '🏟', '🎡', '🎢', '🎠', '⛲', '⛱', '🏖', '🏝', '🏜', '🌋', '⛰', '🏔', '🗻', '🏕', '⛺', '🛖', '🏠', '🏡', '🏘', '🏚', '🏗', '🏭', '🏢', '🏬', '🏣', '🏤', '🏥', '🏦', '🏨', '🏪', '🏫', '🏩', '💒', '🏛', '⛪', '🕌', '🕍', '🛕', '🕋'],
            objects: ['⌚', '📱', '📲', '💻', '⌨', '🖥', '🖨', '🖱', '🖲', '🕹', '🗜', '💾', '💿', '📀', '📼', '📷', '📸', '📹', '🎥', '📽', '🎞', '📞', '☎', '📟', '📠', '📺', '📻', '🎙', '🎚', '🎛', '🧭', '⏱', '⏲', '⏰', '🕰', '⌛', '⏳', '📡', '🔋', '🔌', '💡', '🔦', '🕯', '🪔', '🧯', '🛢', '💸', '💵', '💴', '💶', '💷', '🪙', '💰', '💳', '💎', '⚖', '🪜', '🧰', '🪛', '🔧', '🔨', '⚒', '🛠', '⛏', '🪚', '🔩', '⚙', '🪤', '🧱', '⛓', '🧲', '🔫', '💣', '🧨', '🪓', '🔪', '🗡', '⚔', '🛡', '🚬', '⚰', '🪦', '⚱', '🏺', '🔮', '📿', '🧿', '💈', '⚗', '🔭', '🔬', '🕳', '🩹', '🩺', '💊', '💉', '🩸', '🧬', '🦠', '🧫', '🧪', '🌡', '🧹', '🪠', '🧺', '🧻', '🚽', '🚰', '🚿', '🛁', '🛀', '🧼', '🪥', '🪒', '🧽', '🪣', '🧴', '🛎', '🔑', '🗝', '🚪', '🪑', '🛋', '🛏', '🛌', '🧸', '🪆', '🖼', '🪞', '🪟', '🛍', '🎁', '🎈', '🎏', '🎀', '🪄', '🪅', '🎊', '🎉', '🎎', '🏮', '🎐', '🧧', '✉', '📩', '📨', '📧', '💌', '📥', '📤', '📦', '🏷', '🪧', '📪', '📫', '📬', '📭', '📮', '📯', '📜', '📃', '📄', '📑', '🧾', '📊', '📈', '📉', '🗒', '🗓', '📆', '📅', '🗑', '📇', '🗃', '🗳', '🗄', '📋', '📁', '📂', '🗂', '🗞', '📰', '📓', '📔', '📒', '📕', '📗', '📘', '📙', '📚', '📖', '🔖', '🧷', '🔗', '📎', '🖇', '📐', '📏', '🧮', '📌', '📍', '✂', '🖊', '🖋', '✒', '🖌', '🖍', '📝', '✏', '🔍', '🔎', '🔏', '🔐', '🔒', '🔓'],
            symbols: ['❤', '🧡', '💛', '💚', '💙', '💜', '🖤', '🤍', '🤎', '💔', '❣', '💕', '💞', '💓', '💗', '💖', '💘', '💝', '💟', '☮', '✝', '☪', '🕉', '☸', '✡', '🔯', '🕎', '☯', '☦', '🛐', '⛎', '♈', '♉', '♊', '♋', '♌', '♍', '♎', '♏', '♐', '♑', '♒', '♓', '🆔', '⚛', '🉑', '☢', '☣', '📴', '📳', '🈶', '🈚', '🈸', '🈺', '🈷', '✴', '🆚', '💮', '🉐', '㊙', '㊗', '🈴', '🈵', '🈹', '🈲', '🅰', '🅱', '🆎', '🆑', '🅾', '🆘', '❌', '⭕', '🛑', '⛔', '📛', '🚫', '💯', '💢', '♨', '🚷', '🚯', '🚳', '🚱', '🔞', '📵', '🚭', '❗', '❕', '❓', '❔', '‼', '⁉', '🔅', '🔆', '〽', '⚠', '🚸', '🔱', '⚜', '🔰', '♻', '✅', '🈯', '💹', '❇', '✳', '❎', '🌐', '💠', 'Ⓜ', '🌀', '💤', '🏧', '🚾', '♿', '🅿', '🛗', '🈳', '🈂', '🛂', '🛃', '🛄', '🛅', '🚹', '🚺', '🚼', '⚧', '🚻', '🚮', '🎦', '📶', '🈁', '🔣', 'ℹ', '🔤', '🔡', '🔠', '🆖', '🆗', '🆙', '🆒', '🆕', '🆓', '0⃣', '1⃣', '2⃣', '3⃣', '4⃣', '5⃣', '6⃣', '7⃣', '8⃣', '9⃣', '🔟', '🔢', '#⃣', '*⃣', '⏏', '▶', '⏸', '⏯', '⏹', '⏺', '⏭', '⏮', '⏩', '⏪', '⏫', '⏬', '◀', '🔼', '🔽', '➡', '⬅', '⬆', '⬇', '↗', '↘', '↙', '↖', '↕', '↔', '↪', '↩', '⤴', '⤵', '🔀', '🔁', '🔂', '🔄', '🔃', '🎵', '🎶', '➕', '➖', '➗', '✖', '♾', '💲', '💱', '™', '©', '®', '〰', '➰', '➿', '🔚', '🔙', '🔛', '🔝', '🔜', '✔', '☑', '🔘', '🔴', '🟠', '🟡', '🟢', '🔵', '🟣', '⚫', '⚪', '🟤', '🔺', '🔻', '🔸', '🔹', '🔶', '🔷', '🔳', '🔲', '▪', '▫', '◾', '◽', '◼', '◻', '🟥', '🟧', '🟨', '🟩', '🟦', '🟪', '⬛', '⬜', '🟫', '🔈', '🔇', '🔉', '🔊', '🔔', '🔕', '📣', '📢', '👁‍🗨', '💬', '💭', '🗯', '♠', '♣', '♥', '♦', '🃏', '🎴', '🀄', '🕐', '🕑', '🕒', '🕓', '🕔', '🕕', '🕖', '🕗', '🕘', '🕙', '🕚', '🕛', '🕜', '🕝', '🕞', '🕟', '🕠', '🕡', '🕢', '🕣', '🕤', '🕥', '🕦', '🕧'],
            flags: ['🏴', '🏳', '🏳️‍🌈', '🏳️‍⚧️', '🏴‍☠️', '🇦🇨', '🇦🇩', '🇦🇪', '🇦🇫', '🇦🇬', '🇦🇮', '🇦🇱', '🇦🇲', '🇦🇴', '🇦🇶', '🇦🇷', '🇦🇸', '🇦🇹', '🇦🇺', '🇦🇼', '🇦🇽', '🇦🇿', '🇧🇦', '🇧🇧', '🇧🇩', '🇧🇪', '🇧🇫', '🇧🇬', '🇧🇭', '🇧🇮', '🇧🇯', '🇧🇱', '🇧🇲', '🇧🇳', '🇧🇴', '🇧🇶', '🇧🇷', '🇧🇸', '🇧🇹', '🇧🇻', '🇧🇼', '🇧🇾', '🇧🇿', '🇨🇦', '🇨🇨', '🇨🇩', '🇨🇫', '🇨🇬', '🇨🇭', '🇨🇮', '🇨🇰', '🇨🇱', '🇨🇲', '🇨🇳', '🇨🇴', '🇨🇵', '🇨🇷', '🇨🇺', '🇨🇻', '🇨🇼', '🇨🇽', '🇨🇾', '🇨🇿', '🇩🇪', '🇩🇬', '🇩🇯', '🇩🇰', '🇩🇲', '🇩🇴', '🇩🇿', '🇪🇦', '🇪🇨', '🇪🇪', '🇪🇬', '🇪🇭', '🇪🇷', '🇪🇸', '🇪🇹', '🇪🇺', '🇫🇮', '🇫🇯', '🇫🇰', '🇫🇲', '🇫🇴', '🇫🇷', '🇬🇦', '🇬🇧', '🇬🇩', '🇬🇪', '🇬🇫', '🇬🇬', '🇬🇭', '🇬🇮', '🇬🇱', '🇬🇲', '🇬🇳', '🇬🇵', '🇬🇶', '🇬🇷', '🇬🇸', '🇬🇹', '🇬🇺', '🇬🇼', '🇬🇾', '🇭🇰', '🇭🇲', '🇭🇳', '🇭🇷', '🇭🇹', '🇭🇺', '🇮🇨', '🇮🇩', '🇮🇪', '🇮🇱', '🇮🇲', '🇮🇳', '🇮🇴', '🇮🇶', '🇮🇷', '🇮🇸', '🇮🇹', '🇯🇪', '🇯🇲', '🇯🇴', '🇯🇵', '🇰🇪', '🇰🇬', '🇰🇭', '🇰🇮', '🇰🇲', '🇰🇳', '🇰🇵', '🇰🇷', '🇰🇼', '🇰🇾', '🇰🇿', '🇱🇦', '🇱🇧', '🇱🇨', '🇱🇮', '🇱🇰', '🇱🇷', '🇱🇸', '🇱🇹', '🇱🇺', '🇱🇻', '🇱🇾', '🇲🇦', '🇲🇨', '🇲🇩', '🇲🇪', '🇲🇫', '🇲🇬', '🇲🇭', '🇲🇰', '🇲🇱', '🇲🇲', '🇲🇳', '🇲🇴', '🇲🇵', '🇲🇶', '🇲🇷', '🇲🇸', '🇲🇹', '🇲🇺', '🇲🇻', '🇲🇼', '🇲🇽', '🇲🇾', '🇲🇿', '🇳🇦', '🇳🇨', '🇳🇪', '🇳🇫', '🇳🇬', '🇳🇮', '🇳🇱', '🇳🇴', '🇳🇵', '🇳🇷', '🇳🇺', '🇳🇿', '🇴🇲', '🇵🇦', '🇵🇪', '🇵🇫', '🇵🇬', '🇵🇭', '🇵🇰', '🇵🇱', '🇵🇲', '🇵🇳', '🇵🇷', '🇵🇸', '🇵🇹', '🇵🇼', '🇵🇾', '🇶🇦', '🇷🇪', '🇷🇴', '🇷🇸', '🇷🇺', '🇷🇼', '🇸🇦', '🇸🇧', '🇸🇨', '🇸🇩', '🇸🇪', '🇸🇬', '🇸🇭', '🇸🇮', '🇸🇯', '🇸🇰', '🇸🇱', '🇸🇲', '🇸🇳', '🇸🇴', '🇸🇷', '🇸🇸', '🇸🇹', '🇸🇻', '🇸🇽', '🇸🇾', '🇸🇿', '🇹🇦', '🇹🇨', '🇹🇩', '🇹🇫', '🇹🇬', '🇹🇭', '🇹🇯', '🇹🇰', '🇹🇱', '🇹🇲', '🇹🇳', '🇹🇴', '🇹🇷', '🇹🇹', '🇹🇻', '🇹🇼', '🇹🇿', '🇺🇦', '🇺🇬', '🇺🇲', '🇺🇳', '🇺🇸', '🇺🇾', '🇺🇿', '🇻🇦', '🇻🇨', '🇻🇪', '🇻🇬', '🇻🇮', '🇻🇳', '🇻🇺', '🇼🇫', '🇼🇸', '🇽🇰', '🇾🇪', '🇾🇹', '🇿🇦', '🇿🇲', '🇿🇼', '🏴󠁧󠁢󠁥󠁮󠁧󠁿', '🏴󠁧󠁢󠁳󠁣󠁴󠁿', '🏴󠁧󠁢󠁷󠁬󠁳󠁿']
        };

        let allEmojis = [];
        let currentCategory = 'all';
        let filteredEmojis = [];

        function initializeEmojiPicker() {
            // Flatten all emojis
            allEmojis = Object.values(emojiData).flat();
            filteredEmojis = allEmojis;
        }

        function openEmojiPicker() {
            if (!currentTrip) return;
            
            emojiPickerContext = 'trip'; // Set context to trip
            
            const modal = document.getElementById('emojiPickerModal');
            modal.classList.remove('hidden');
            
            // Update title based on language
            document.getElementById('emojiPickerTitle').textContent = currentLanguage === 'en' ? 'Choose an Emoji' : 'Elige un Emoji';
            document.getElementById('emojiSearchInput').placeholder = currentLanguage === 'en' ? 'Search emojis...' : 'Buscar emojis...';
            
            // Reset and render
            currentCategory = 'all';
            document.getElementById('emojiSearchInput').value = '';
            updateCategoryButtons();
            renderEmojis(allEmojis);
        }

        function closeEmojiPicker() {
            const modal = document.getElementById('emojiPickerModal');
            modal.classList.add('hidden');
        }

        function renderEmojis(emojis) {
            const grid = document.getElementById('emojiPickerGrid');
            grid.innerHTML = '';
            
            if (emojis.length === 0) {
                grid.innerHTML = `<div class="emoji-picker-empty">${currentLanguage === 'en' ? 'No emojis found' : 'No se encontraron emojis'}</div>`;
                return;
            }
            
            emojis.forEach(emoji => {
                const button = document.createElement('button');
                button.className = 'emoji-item';
                button.textContent = emoji;
                button.onclick = () => selectEmoji(emoji);
                grid.appendChild(button);
            });
        }

        function selectEmoji(emoji) {
            if (!currentTrip) return;
            
            // Check if we're selecting emoji for an activity or for the trip
            if (emojiPickerContext === 'activity') {
                selectActivityEmoji(emoji);
                return;
            }
            
            // Otherwise, this is for the trip emoji
            currentTrip.emoji = emoji;
            
            // Update the icon immediately
            document.getElementById('tripIcon').textContent = currentTrip.emoji;
            
            // Save to localStorage
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            const tripIndex = users[currentUser].trips.findIndex(t => t.id === currentTrip.id);
            if (tripIndex !== -1) {
                users[currentUser].trips[tripIndex].emoji = currentTrip.emoji;
                localStorage.setItem('users', JSON.stringify(users));
            }
            
            // Refresh sidebar and home page
            loadSidebarTrips();
            loadTrips();
            
            // Close the picker
            closeEmojiPicker();
        }

        function filterEmojiCategory(category) {
            currentCategory = category;
            updateCategoryButtons();
            
            if (category === 'all') {
                filteredEmojis = allEmojis;
            } else {
                filteredEmojis = emojiData[category] || [];
            }
            
            renderEmojis(filteredEmojis);
        }

        function updateCategoryButtons() {
            const buttons = document.querySelectorAll('.emoji-category-btn');
            buttons.forEach(btn => {
                if (btn.dataset.category === currentCategory) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        function searchEmojis(query) {
            if (!query.trim()) {
                filterEmojiCategory(currentCategory);
                return;
            }
            
            const lowerQuery = query.toLowerCase();
            
            // Simple keyword mapping for common searches
            const keywords = {
                'smile': ['😀', '😃', '😄', '😁', '😆', '😊', '🙂', '😸'],
                'happy': ['😀', '😃', '😄', '😁', '😆', '😊', '🥰', '😍', '🤗'],
                'love': ['❤', '💕', '💖', '💗', '💘', '💝', '💞', '💓', '🥰', '😍', '😘', '💏', '💑'],
                'heart': ['❤', '🧡', '💛', '💚', '💙', '💜', '🖤', '🤍', '🤎', '💔', '💕', '💖', '💗', '💘', '💝'],
                'sad': ['😢', '😭', '😔', '😞', '😿'],
                'laugh': ['😂', '🤣', '😆', '😹'],
                'angry': ['😠', '😡', '🤬', '😾'],
                'fire': ['🔥', '🧯'],
                'star': ['⭐', '🌟', '✨', '💫', '🌠'],
                'sun': ['☀', '🌞', '🌅', '🌄'],
                'moon': ['🌙', '🌛', '🌜', '🌚'],
                'food': ['🍕', '🍔', '🍟', '🌮', '🌯', '🍎', '🍌', '🍉', '🍇', '🍓', '🍒', '🍑', '🥑', '🍆', '🥐', '🥖', '🥨', '🧀', '🍖', '🍗', '🥩', '🥓', '🍳', '🥞', '🧇', '🍕', '🍔', '🍟', '🌭', '🍿', '🧈', '🥗', '🍜', '🍲', '🍱', '🍣', '🥟', '🍤', '🍙', '🍚', '🍘', '🍥', '🥠', '🍡', '🍧', '🍨', '🍦', '🥧', '🧁', '🍰', '🎂', '🍮', '🍭', '🍬', '🍫', '🍩', '🍪'],
                'drink': ['☕', '🍵', '🧃', '🥤', '🧋', '🍶', '🍺', '🍻', '🥂', '🍷', '🥃', '🍸', '🍹', '🧉', '🍾', '🧊'],
                'travel': ['✈', '🚗', '🚕', '🚙', '🚌', '🚎', '🏎', '🚓', '🚑', '🚒', '🚐', '🚚', '🚛', '🚜', '🛴', '🚲', '🛵', '🏍', '🚁', '🚀', '🛸', '🛶', '⛵', '🚤', '🛥', '🛳', '⛴', '🚢'],
                'plane': ['✈', '🛫', '🛬', '🛩', '🚁', '🛸', '🚀'],
                'car': ['🚗', '🚕', '🚙', '🚌', '🏎', '🚓', '🚔'],
                'music': ['🎵', '🎶', '🎤', '🎧', '🎸', '🎹', '🎺', '🎻', '🥁', '🎷', '🎼'],
                'sport': ['⚽', '🏀', '🏈', '⚾', '🥎', '🎾', '🏐', '🏉', '🎱', '🏓', '🏸', '🥊', '🥋', '🤺', '🏆', '🥇', '🥈', '🥉'],
                'animal': emojiData.animals,
                'dog': ['🐶', '🐕', '🐩', '🐕‍🦺'],
                'cat': ['🐱', '🐈', '🐈‍⬛'],
                'beach': ['🏖', '🏝', '⛱', '🏄', '🏊', '🤿', '🌊'],
                'mountain': ['⛰', '🏔', '🗻', '🏕', '⛺'],
                'weather': ['☀', '⛅', '☁', '🌤', '🌥', '🌦', '🌧', '⛈', '🌩', '🌨', '❄', '☃', '⛄', '🌬', '💨', '🌪', '🌫', '🌈'],
                'rain': ['🌧', '⛈', '🌦', '🌨', '💧', '☔'],
                'snow': ['❄', '☃', '⛄', '🌨'],
                'party': ['🎉', '🎊', '🎈', '🎁', '🎀', '🎂', '🍰', '🧁', '🥳', '🎆', '🎇'],
                'flag': emojiData.flags,
                'check': ['✅', '✔', '☑'],
                'cross': ['❌', '❎', '✖'],
                'arrow': ['➡', '⬅', '⬆', '⬇', '↗', '↘', '↙', '↖', '↕', '↔'],
                'number': ['0⃣', '1⃣', '2⃣', '3⃣', '4⃣', '5⃣', '6⃣', '7⃣', '8⃣', '9⃣', '🔟']
            };
            
            // Check if the query matches any keyword
            let results = [];
            for (const [key, emojis] of Object.entries(keywords)) {
                if (key.includes(lowerQuery) || lowerQuery.includes(key)) {
                    results = results.concat(emojis);
                }
            }
            
            // Remove duplicates
            results = [...new Set(results)];
            
            // If no keyword matches, search in the current category
            if (results.length === 0) {
                const emojisToSearch = currentCategory === 'all' ? allEmojis : emojiData[currentCategory];
                results = emojisToSearch.slice(0, 50); // Show first 50 if no match
            }
            
            renderEmojis(results);
        }

        function changeEmoji() {
            if (!currentTrip) return;
            openEmojiPicker();
        }

        function saveCurrentTrip() {
            if (!currentTrip) return;

            // Update trip name if changed
            const tripNameInput = document.getElementById('tripName');
            if (tripNameInput) {
                currentTrip.name = tripNameInput.value;
            }

            // Update notes if changed
            const tripNotesInput = document.getElementById('tripNotes');
            if (tripNotesInput) {
                currentTrip.notes = tripNotesInput.value;
            }

            // Update custom list name
            const customListNameInput = document.getElementById('customListName');
            if (customListNameInput) {
                currentTrip.checklists.customName = customListNameInput.value;
            }

            const users = JSON.parse(localStorage.getItem('users') || '{}');
            const tripIndex = users[currentUser].trips.findIndex(t => t.id === currentTrip.id);
            
            if (tripIndex !== -1) {
                users[currentUser].trips[tripIndex] = currentTrip;
                localStorage.setItem('users', JSON.stringify(users));
            }
        }

        function deleteTrip() {
            if (!currentTrip) return;

            const confirmMsg = currentLanguage === 'en' 
                ? 'Are you sure you want to delete this trip?' 
                : '¿Estás seguro de que quieres eliminar este viaje?';
            
            if (!confirm(confirmMsg)) return;

            const users = JSON.parse(localStorage.getItem('users') || '{}');
            const tripIndex = users[currentUser].trips.findIndex(t => t.id === currentTrip.id);
            
            if (tripIndex !== -1) {
                users[currentUser].trips.splice(tripIndex, 1);
                localStorage.setItem('users', JSON.stringify(users));
                showLandingPage();
            }
        }

        // Clothing Drop Animation
        function triggerClothingAnimation() {
            const container = document.createElement('div');
            container.className = 'clothing-animation-container';
            document.body.appendChild(container);

            const clothingItems = ['👕', '👔', '👗', '👘', '👚', '👖', '👙', '🩱', '🧥', '🧤', '🧣', '🧦', '👟', '👠', '👡', '👢', '👞', '🥾', '🩴', '👒', '🎩', '🧢', '👑', '🎒', '👜', '💼', '🧳'];
            
            // Create 15 random clothing items
            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    const item = document.createElement('div');
                    item.className = 'clothing-item';
                    item.textContent = clothingItems[Math.floor(Math.random() * clothingItems.length)];
                    
                    // Random horizontal position
                    item.style.left = Math.random() * 100 + '%';
                    
                    // Random delay
                    item.style.animationDelay = Math.random() * 0.5 + 's';
                    
                    // Random duration for variety
                    item.style.animationDuration = (1.5 + Math.random() * 0.5) + 's';
                    
                    container.appendChild(item);
                    
                    // Remove item after animation
                    setTimeout(() => {
                        item.remove();
                    }, 2500);
                }, i * 100);
            }
            
            // Remove container after all animations
            setTimeout(() => {
                container.remove();
            }, 4000);
        }

        // Background Clothing Animation for Auth Screen
        let authAnimationInterval = null;
        
        function startAuthBackgroundAnimation() {
            const container = document.getElementById('authBgAnimation');
            if (!container) return;
            
            const clothingItems = ['👕', '👔', '👗', '👘', '👚', '👖', '👙', '🩱', '🧥', '🧤', '🧣', '🧦', '👟', '👠', '👡', '👢', '👞', '🥾', '🩴', '👒', '🎩', '🧢', '🎒', '👜', '💼', '🧳'];
            
            function createClothingItem() {
                const item = document.createElement('div');
                item.className = 'auth-bg-clothing';
                item.textContent = clothingItems[Math.floor(Math.random() * clothingItems.length)];
                
                // Random horizontal position
                item.style.left = Math.random() * 100 + '%';
                
                // Random delay
                item.style.animationDelay = Math.random() * 2 + 's';
                
                // Random duration for variety
                item.style.animationDuration = (6 + Math.random() * 4) + 's';
                
                container.appendChild(item);
                
                // Remove item after animation completes
                setTimeout(() => {
                    if (item.parentNode) {
                        item.remove();
                    }
                }, 12000);
            }
            
            // Create initial batch
            for (let i = 0; i < 8; i++) {
                setTimeout(() => createClothingItem(), i * 1000);
            }
            
            // Keep creating new items periodically
            authAnimationInterval = setInterval(() => {
                createClothingItem();
            }, 1500);
        }
        
        function stopAuthBackgroundAnimation() {
            if (authAnimationInterval) {
                clearInterval(authAnimationInterval);
                authAnimationInterval = null;
            }
            const container = document.getElementById('authBgAnimation');
            if (container) {
                container.innerHTML = '';
            }
        }
    </script>

    <!-- Clothing Animation Container -->
    <div id="clothingAnimationContainer"></div>
</body>
</html>

